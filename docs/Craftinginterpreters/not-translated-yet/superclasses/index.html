<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Craftinginterpreters/not-translated-yet/superclasses" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">superclasses | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jabberwocky238.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jabberwocky238.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jabberwocky238.github.io/docs/Craftinginterpreters/not-translated-yet/superclasses"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="superclasses | My Site"><meta data-rh="true" name="description" content="You can choose your friends but you sho&#x27; can&#x27;t choose your family, an&#x27; they&#x27;re"><meta data-rh="true" property="og:description" content="You can choose your friends but you sho&#x27; can&#x27;t choose your family, an&#x27; they&#x27;re"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jabberwocky238.github.io/docs/Craftinginterpreters/not-translated-yet/superclasses"><link data-rh="true" rel="alternate" href="https://jabberwocky238.github.io/docs/Craftinginterpreters/not-translated-yet/superclasses" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://jabberwocky238.github.io/docs/Craftinginterpreters/not-translated-yet/superclasses" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.0d35426a.css">
<script src="/assets/js/runtime~main.0868a236.js" defer="defer"></script>
<script src="/assets/js/main.f1c02528.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jabberwocky238/jabberwocky238.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为暗黑模式）" aria-label="切换浅色/暗黑模式（当前为暗黑模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorial---basics">Tutorial - Basics</a><button aria-label="展开侧边栏分类 &#x27;Tutorial - Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/tutorial---extras">Tutorial - Extras</a><button aria-label="展开侧边栏分类 &#x27;Tutorial - Extras&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/english">English</a><button aria-label="展开侧边栏分类 &#x27;English&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/crafting-interpreter">Crafting-interpreter</a><button aria-label="折叠侧边栏分类 &#x27;Crafting-interpreter&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/welcome">Welcome</a><button aria-label="展开侧边栏分类 &#x27;Welcome&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/not-translated-yet">not-translated-yet</a><button aria-label="折叠侧边栏分类 &#x27;not-translated-yet&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/a-bytecode-virtual-machine">a-bytecode-virtual-machine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/a-tree-walk-interpreter">a-tree-walk-interpreter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/a-virtual-machine">a-virtual-machine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/acknowledgements">acknowledgements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/appendix-i">appendix-i</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/appendix-ii">appendix-ii</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/backmatter">backmatter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/calls-and-functions">calls-and-functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/chunks-of-bytecode">chunks-of-bytecode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/classes-and-instances">classes-and-instances</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/classes">classes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/closures">closures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/compiling-expressions">compiling-expressions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/contents">contents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/control-flow">control-flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/dedication">dedication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/evaluating-expressions">evaluating-expressions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/functions">functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/garbage-collection">garbage-collection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/global-variables">global-variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/hash-tables">hash-tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/inheritance">inheritance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/jumping-back-and-forth">jumping-back-and-forth</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/local-variables">local-variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/methods-and-initializers">methods-and-initializers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/optimization">optimization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/parsing-expressions">parsing-expressions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/representing-code">representing-code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/resolving-and-binding">resolving-and-binding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/scanning-on-demand">scanning-on-demand</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/scanning">scanning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/statements-and-state">statements-and-state</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/strings">strings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/superclasses">superclasses</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/the-lox-language">the-lox-language</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Craftinginterpreters/not-translated-yet/types-of-values">types-of-values</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/crafting-interpreter"><span itemprop="name">Crafting-interpreter</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/not-translated-yet"><span itemprop="name">not-translated-yet</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">superclasses</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>superclasses</h1></header><blockquote>
<p>You can choose your friends but you sho&#x27; can&#x27;t choose your family, an&#x27; they&#x27;re
still kin to you no matter whether you acknowledge ’em or not, and it
makes you look right silly when you don&#x27;t.</p>
<p><cite>Harper Lee, <em>To Kill a Mockingbird</em></cite></p>
</blockquote>
<p>This is the very last chapter where we add new functionality to our VM. We&#x27;ve
packed almost the entire Lox language in there already. All that remains is
inheriting methods and calling superclass methods. We have <a href="/docs/Craftinginterpreters/not-translated-yet/optimization.html">another
chapter</a> after this one, but it introduces no new behavior. It
<span name="faster">only</span> makes existing stuff faster. Make it to the end
of this one, and you&#x27;ll have a complete Lox implementation.</p>
<aside name="faster">
<p>That &quot;only&quot; should not imply that making stuff faster isn&#x27;t important! After
all, the whole purpose of our entire second virtual machine is better
performance over jlox. You could argue that <em>all</em> of the past fifteen chapters
are &quot;optimization&quot;.</p>
</aside>
<p>Some of the material in this chapter will remind you of jlox. The way we resolve
super calls is pretty much the same, though viewed through clox&#x27;s more complex
mechanism for storing state on the stack. But we have an entirely different,
much faster, way of handling inherited method calls this time around.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="inheriting-methods">Inheriting Methods<a href="#inheriting-methods" class="hash-link" aria-label="Inheriting Methods的直接链接" title="Inheriting Methods的直接链接">​</a></h2>
<p>We&#x27;ll kick things off with method inheritance since it&#x27;s the simpler piece. To
refresh your memory, Lox inheritance syntax looks like this:</p>
<div class="language-lox codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lox codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Doughnut {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cook() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;Dunk in the fryer.&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Cruller &lt; Doughnut {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  finish() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;Glaze with icing.&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here, the Cruller class inherits from Doughnut and thus, instances of Cruller
inherit the <code>cook()</code> method. I don&#x27;t know why I&#x27;m belaboring this. You know how
inheritance works. Let&#x27;s start compiling the new syntax.</p>
<p>^code compile-superclass (2 before, 1 after)</p>
<p>After we compile the class name, if the next token is a <code>&lt;</code>, then we found a
superclass clause. We consume the superclass&#x27;s identifier token, then call
<code>variable()</code>. That function takes the previously consumed token, treats it as a
variable reference, and emits code to load the variable&#x27;s value. In other words,
it looks up the superclass by name and pushes it onto the stack.</p>
<p>After that, we call <code>namedVariable()</code> to load the subclass doing the inheriting
onto the stack, followed by an <code>OP_INHERIT</code> instruction. That instruction
wires up the superclass to the new subclass. In the last chapter, we defined an
<code>OP_METHOD</code> instruction to mutate an existing class object by adding a method to
its method table. This is similar -- the <code>OP_INHERIT</code> instruction takes an
existing class and applies the effect of inheritance to it.</p>
<p>In the previous example, when the compiler works through this bit of syntax:</p>
<div class="language-lox codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lox codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Cruller &lt; Doughnut {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result is this bytecode:</p>
<img decoding="async" loading="lazy" src="image/superclasses/inherit-stack.png" alt="The series of bytecode instructions for a Cruller class inheriting from Doughnut." class="img_ev3q">
<p>Before we implement the new <code>OP_INHERIT</code> instruction, we have an edge case to
detect.</p>
<p>^code inherit-self (1 before, 1 after)</p>
<p><span name="cycle">A</span> class cannot be its own superclass. Unless you have
access to a deranged nuclear physicist and a very heavily modified DeLorean, you
cannot inherit from yourself.</p>
<aside name="cycle">
<p>Interestingly, with the way we implement method inheritance, I don&#x27;t think
allowing cycles would actually cause any problems in clox. It wouldn&#x27;t do
anything <em>useful</em>, but I don&#x27;t think it would cause a crash or infinite loop.</p>
</aside>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="executing-inheritance">Executing inheritance<a href="#executing-inheritance" class="hash-link" aria-label="Executing inheritance的直接链接" title="Executing inheritance的直接链接">​</a></h3>
<p>Now onto the new instruction.</p>
<p>^code inherit-op (1 before, 1 after)</p>
<p>There are no operands to worry about. The two values we need -- superclass and
subclass -- are both found on the stack. That means disassembling is easy.</p>
<p>^code disassemble-inherit (1 before, 1 after)</p>
<p>The interpreter is where the action happens.</p>
<p>^code interpret-inherit (1 before, 1 after)</p>
<p>From the top of the stack down, we have the subclass then the superclass. We
grab both of those and then do the inherit-y bit. This is where clox takes a
different path than jlox. In our first interpreter, each subclass stored a
reference to its superclass. On method access, if we didn&#x27;t find the method in
the subclass&#x27;s method table, we recursed through the inheritance chain looking
at each ancestor&#x27;s method table until we found it.</p>
<p>For example, calling <code>cook()</code> on an instance of Cruller sends jlox on this
journey:</p>
<img decoding="async" loading="lazy" src="image/superclasses/jlox-resolve.png" alt="Resolving a call to cook() in an instance of Cruller means walking the superclass chain." class="img_ev3q">
<p>That&#x27;s a lot of work to perform during method <em>invocation</em> time. It&#x27;s slow, and
worse, the farther an inherited method is up the ancestor chain, the slower it
gets. Not a great performance story.</p>
<p>The new approach is much faster. When the subclass is declared, we copy all of
the inherited class&#x27;s methods down into the subclass&#x27;s own method table. Later,
when <em>calling</em> a method, any method inherited from a superclass will be found
right in the subclass&#x27;s own method table. There is no extra runtime work needed
for inheritance at all. By the time the class is declared, the work is done.
This means inherited method calls are exactly as fast as normal method calls --
a <span name="two">single</span> hash table lookup.</p>
<img decoding="async" loading="lazy" src="image/superclasses/clox-resolve.png" alt="Resolving a call to cook() in an instance of Cruller which has the method in its own method table." class="img_ev3q">
<aside name="two">
<p>Well, two hash table lookups, I guess. Because first we have to make sure a
field on the instance doesn&#x27;t shadow the method.</p>
</aside>
<p>I&#x27;ve sometimes heard this technique called &quot;copy-down inheritance&quot;. It&#x27;s simple
and fast, but, like most optimizations, you get to use it only under certain
constraints. It works in Lox because Lox classes are <em>closed</em>. Once a class
declaration is finished executing, the set of methods for that class can never
change.</p>
<p>In languages like Ruby, Python, and JavaScript, it&#x27;s possible to <span name="monkey">crack</span> open an existing class and jam some new methods into
it or even remove them. That would break our optimization because if those
modifications happened to a superclass <em>after</em> the subclass declaration
executed, the subclass would not pick up those changes. That breaks a user&#x27;s
expectation that inheritance always reflects the current state of the
superclass.</p>
<aside name="monkey">
<p>As you can imagine, changing the set of methods a class defines imperatively at
runtime can make it hard to reason about a program. It is a very powerful tool,
but also a dangerous tool.</p>
<p>Those who find this tool maybe a little <em>too</em> dangerous gave it the unbecoming
name &quot;monkey patching&quot;, or the even less decorous &quot;duck punching&quot;.</p>
<img decoding="async" loading="lazy" src="image/superclasses/monkey.png" alt="A monkey with an eyepatch, naturally." class="img_ev3q">
</aside>
<p>Fortunately for us (but not for users who like the feature, I guess), Lox
doesn&#x27;t let you patch monkeys or punch ducks, so we can safely apply this
optimization.</p>
<p>What about method overrides? Won&#x27;t copying the superclass&#x27;s methods into the
subclass&#x27;s method table clash with the subclass&#x27;s own methods? Fortunately, no.
We emit the <code>OP_INHERIT</code> after the <code>OP_CLASS</code> instruction that creates the
subclass but before any method declarations and <code>OP_METHOD</code> instructions have
been compiled. At the point that we copy the superclass&#x27;s methods down, the
subclass&#x27;s method table is empty. Any methods the subclass overrides will
overwrite those inherited entries in the table.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="invalid-superclasses">Invalid superclasses<a href="#invalid-superclasses" class="hash-link" aria-label="Invalid superclasses的直接链接" title="Invalid superclasses的直接链接">​</a></h3>
<p>Our implementation is simple and fast, which is just the way I like my VM code.
But it&#x27;s not robust. Nothing prevents a user from inheriting from an object that
isn&#x27;t a class at all:</p>
<div class="language-lox codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lox codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">var NotClass = &quot;So not a class&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class OhNo &lt; NotClass {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Obviously, no self-respecting programmer would write that, but we have to guard
against potential Lox users who have no self respect. A simple runtime check
fixes that.</p>
<p>^code inherit-non-class (1 before, 1 after)</p>
<p>If the value we loaded from the identifier in the superclass clause isn&#x27;t an
ObjClass, we report a runtime error to let the user know what we think of them
and their code.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="storing-superclasses">Storing Superclasses<a href="#storing-superclasses" class="hash-link" aria-label="Storing Superclasses的直接链接" title="Storing Superclasses的直接链接">​</a></h2>
<p>Did you notice that when we added method inheritance, we didn&#x27;t actually add any
reference from a subclass to its superclass? After we copy the inherited methods
over, we forget the superclass entirely. We don&#x27;t need to keep a handle on the
superclass, so we don&#x27;t.</p>
<p>That won&#x27;t be sufficient to support super calls. Since a subclass <span name="may">may</span> override the superclass method, we need to be able to get
our hands on superclass method tables. Before we get to that mechanism, I want
to refresh your memory on how super calls are statically resolved.</p>
<aside name="may">
<p>&quot;May&quot; might not be a strong enough word. Presumably the method <em>has</em> been
overridden. Otherwise, why are you bothering to use <code>super</code> instead of just
calling it directly?</p>
</aside>
<p>Back in the halcyon days of jlox, I showed you <a href="/docs/Craftinginterpreters/not-translated-yet/inheritance.html#semantics">this tricky example</a> to
explain the way super calls are dispatched:</p>
<div class="language-lox codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lox codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class A {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;A method&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class B &lt; A {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;B method&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  test() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    super.method();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class C &lt; B {}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C().test();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Inside the body of the <code>test()</code> method, <code>this</code> is an instance of C. If super
calls were resolved relative to the superclass of the <em>receiver</em>, then we would
look in C&#x27;s superclass, B. But super calls are resolved relative to the
superclass of the <em>surrounding class where the super call occurs</em>. In this case,
we are in B&#x27;s <code>test()</code> method, so the superclass is A, and the program should
print &quot;A method&quot;.</p>
<p>This means that super calls are not resolved dynamically based on the runtime
instance. The superclass used to look up the method is a static -- practically
lexical -- property of where the call occurs. When we added inheritance to jlox,
we took advantage of that static aspect by storing the superclass in the same
Environment structure we used for all lexical scopes. Almost as if the
interpreter saw the above program like this:</p>
<div class="language-lox codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lox codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class A {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;A method&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">var Bs_super = A;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class B &lt; A {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;B method&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  test() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    runtimeSuperCall(Bs_super, &quot;method&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">var Cs_super = B;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class C &lt; B {}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">C().test();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Each subclass has a hidden variable storing a reference to its superclass.
Whenever we need to perform a super call, we access the superclass from that
variable and tell the runtime to start looking for methods there.</p>
<p>We&#x27;ll take the same path with clox. The difference is that instead of jlox&#x27;s
heap-allocated Environment class, we have the bytecode VM&#x27;s value stack and
upvalue system. The machinery is a little different, but the overall effect is
the same.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-superclass-local-variable">A superclass local variable<a href="#a-superclass-local-variable" class="hash-link" aria-label="A superclass local variable的直接链接" title="A superclass local variable的直接链接">​</a></h3>
<p>Our compiler already emits code to load the superclass onto the stack. Instead
of leaving that slot as a temporary, we create a new scope and make it a local
variable.</p>
<p>^code superclass-variable (2 before, 2 after)</p>
<p>Creating a new lexical scope ensures that if we declare two classes in the same
scope, each has a different local slot to store its superclass. Since we always
name this variable &quot;super&quot;, if we didn&#x27;t make a scope for each subclass, the
variables would collide.</p>
<p>We name the variable &quot;super&quot; for the same reason we use &quot;this&quot; as the name of
the hidden local variable that <code>this</code> expressions resolve to: &quot;super&quot; is a
reserved word, which guarantees the compiler&#x27;s hidden variable won&#x27;t collide
with a user-defined one.</p>
<p>The difference is that when compiling <code>this</code> expressions, we conveniently have a
token sitting around whose lexeme is &quot;this&quot;. We aren&#x27;t so lucky here. Instead,
we add a little helper function to create a synthetic token for the given <span name="constant">constant</span> string.</p>
<p>^code synthetic-token</p>
<aside name="constant" class="bottom">
<p>I say &quot;constant string&quot; because tokens don&#x27;t do any memory management of their
lexeme. If we tried to use a heap-allocated string for this, we&#x27;d end up leaking
memory because it never gets freed. But the memory for C string literals lives
in the executable&#x27;s constant data section and never needs to be freed, so we&#x27;re
fine.</p>
</aside>
<p>Since we opened a local scope for the superclass variable, we need to close it.</p>
<p>^code end-superclass-scope (1 before, 2 after)</p>
<p>We pop the scope and discard the &quot;super&quot; variable after compiling the class body
and its methods. That way, the variable is accessible in all of the methods of
the subclass. It&#x27;s a somewhat pointless optimization, but we create the scope
only if there <em>is</em> a superclass clause. Thus we need to close the scope only if
there is one.</p>
<p>To track that, we could declare a little local variable in <code>classDeclaration()</code>.
But soon, other functions in the compiler will need to know whether the
surrounding class is a subclass or not. So we may as well give our future selves
a hand and store this fact as a field in the ClassCompiler now.</p>
<p>^code has-superclass (2 before, 1 after)</p>
<p>When we first initialize a ClassCompiler, we assume it is not a subclass.</p>
<p>^code init-has-superclass (1 before, 1 after)</p>
<p>Then, if we see a superclass clause, we know we are compiling a subclass.</p>
<p>^code set-has-superclass (1 before, 1 after)</p>
<p>This machinery gives us a mechanism at runtime to access the superclass object
of the surrounding subclass from within any of the subclass&#x27;s methods -- simply
emit code to load the variable named &quot;super&quot;. That variable is a local outside
of the method body, but our existing upvalue support enables the VM to capture
that local inside the body of the method or even in functions nested inside that
method.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="super-calls">Super Calls<a href="#super-calls" class="hash-link" aria-label="Super Calls的直接链接" title="Super Calls的直接链接">​</a></h2>
<p>With that runtime support in place, we are ready to implement super calls. As
usual, we go front to back, starting with the new syntax. A super call <span name="last">begins</span>, naturally enough, with the <code>super</code> keyword.</p>
<aside name="last">
<p>This is it, friend. The very last entry you&#x27;ll add to the parsing table.</p>
</aside>
<p>^code table-super (1 before, 1 after)</p>
<p>When the expression parser lands on a <code>super</code> token, control jumps to a new
parsing function which starts off like so:</p>
<p>^code super</p>
<p>This is pretty different from how we compiled <code>this</code> expressions. Unlike <code>this</code>,
a <code>super</code> <span name="token">token</span> is not a standalone expression.
Instead, the dot and method name following it are inseparable parts of the
syntax. However, the parenthesized argument list is separate. As with normal
method access, Lox supports getting a reference to a superclass method as a
closure without invoking it:</p>
<aside name="token">
<p>Hypothetical question: If a bare <code>super</code> token <em>was</em> an expression, what kind of
object would it evaluate to?</p>
</aside>
<div class="language-lox codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lox codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class A {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;A&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class B &lt; A {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  method() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    var closure = super.method;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    closure(); // Prints &quot;A&quot;.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In other words, Lox doesn&#x27;t really have super <em>call</em> expressions, it has super
<em>access</em> expressions, which you can choose to immediately invoke if you want. So
when the compiler hits a <code>super</code> token, we consume the subsequent <code>.</code> token and
then look for a method name. Methods are looked up dynamically, so we use
<code>identifierConstant()</code> to take the lexeme of the method name token and store it
in the constant table just like we do for property access expressions.</p>
<p>Here is what the compiler does after consuming those tokens:</p>
<p>^code super-get (1 before, 1 after)</p>
<p>In order to access a <em>superclass method</em> on <em>the current instance</em>, the runtime
needs both the receiver <em>and</em> the superclass of the surrounding method&#x27;s class.
The first <code>namedVariable()</code> call generates code to look up the current receiver
stored in the hidden variable &quot;this&quot; and push it onto the stack. The second
<code>namedVariable()</code> call emits code to look up the superclass from its &quot;super&quot;
variable and push that on top.</p>
<p>Finally, we emit a new <code>OP_GET_SUPER</code> instruction with an operand for the
constant table index of the method name. That&#x27;s a lot to hold in your head. To
make it tangible, consider this example program:</p>
<div class="language-lox codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lox codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Doughnut {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cook() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;Dunk in the fryer.&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    this.finish(&quot;sprinkles&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  finish(ingredient) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;Finish with &quot; + ingredient;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Cruller &lt; Doughnut {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  finish(ingredient) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // No sprinkles, always icing.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    super.finish(&quot;icing&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The bytecode emitted for the <code>super.finish(&quot;icing&quot;)</code> expression looks and works
like this:</p>
<img decoding="async" loading="lazy" src="image/superclasses/super-instructions.png" alt="The series of bytecode instructions for calling super.finish()." class="img_ev3q">
<p>The first three instructions give the runtime access to the three pieces of
information it needs to perform the super access:</p>
<ol>
<li>
<p>The first instruction loads <strong>the instance</strong> onto the stack.</p>
</li>
<li>
<p>The second instruction loads <strong>the superclass where the method is
resolved</strong>.</p>
</li>
<li>
<p>Then the new <code>OP_GET_SUPER</code> instuction encodes <strong>the name of the method to
access</strong> as an operand.</p>
</li>
</ol>
<p>The remaining instructions are the normal bytecode for evaluating an argument
list and calling a function.</p>
<p>We&#x27;re almost ready to implement the new <code>OP_GET_SUPER</code> instruction in the
interpreter. But before we do, the compiler has some errors it is responsible
for reporting.</p>
<p>^code super-errors (1 before, 1 after)</p>
<p>A super call is meaningful only inside the body of a method (or in a function
nested inside a method), and only inside the method of a class that has a
superclass. We detect both of these cases using the value of <code>currentClass</code>. If
that&#x27;s <code>NULL</code> or points to a class with no superclass, we report those errors.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="executing-super-accesses">Executing super accesses<a href="#executing-super-accesses" class="hash-link" aria-label="Executing super accesses的直接链接" title="Executing super accesses的直接链接">​</a></h3>
<p>Assuming the user didn&#x27;t put a <code>super</code> expression where it&#x27;s not allowed, their
code passes from the compiler over to the runtime. We&#x27;ve got ourselves a new
instruction.</p>
<p>^code get-super-op (1 before, 1 after)</p>
<p>We disassemble it like other opcodes that take a constant table index operand.</p>
<p>^code disassemble-get-super (1 before, 1 after)</p>
<p>You might anticipate something harder, but interpreting the new instruction is
similar to executing a normal property access.</p>
<p>^code interpret-get-super (1 before, 1 after)</p>
<p>As with properties, we read the method name from the
constant table. Then we pass that to <code>bindMethod()</code> which looks up the method in
the given class&#x27;s method table and creates an ObjBoundMethod to bundle the
resulting closure to the current instance.</p>
<p>The key <span name="field">difference</span> is <em>which</em> class we pass to
<code>bindMethod()</code>. With a normal property access, we use the ObjInstances&#x27;s own
class, which gives us the dynamic dispatch we want. For a super call, we don&#x27;t
use the instance&#x27;s class. Instead, we use the statically resolved superclass of
the containing class, which the compiler has conveniently ensured is sitting on
top of the stack waiting for us.</p>
<p>We pop that superclass and pass it to <code>bindMethod()</code>, which correctly skips over
any overriding methods in any of the subclasses between that superclass and the
instance&#x27;s own class. It also correctly includes any methods inherited by the
superclass from any of <em>its</em> superclasses.</p>
<p>The rest of the behavior is the same. Popping the superclass leaves the instance
at the top of the stack. When <code>bindMethod()</code> succeeds, it pops the instance and
pushes the new bound method. Otherwise, it reports a runtime error and returns
<code>false</code>. In that case, we abort the interpreter.</p>
<aside name="field">
<p>Another difference compared to <code>OP_GET_PROPERTY</code> is that we don&#x27;t try to look
for a shadowing field first. Fields are not inherited, so <code>super</code> expressions
always resolve to methods.</p>
<p>If Lox were a prototype-based language that used <em>delegation</em> instead of
<em>inheritance</em>, then instead of one <em>class</em> inheriting from another <em>class</em>,
instances would inherit from (&quot;delegate to&quot;) other instances. In that case,
fields <em>could</em> be inherited, and we would need to check for them here.</p>
</aside>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="faster-super-calls">Faster super calls<a href="#faster-super-calls" class="hash-link" aria-label="Faster super calls的直接链接" title="Faster super calls的直接链接">​</a></h3>
<p>We have superclass method accesses working now. And since the returned object is
an ObjBoundMethod that you can then invoke, we&#x27;ve got super <em>calls</em> working too.
Just like last chapter, we&#x27;ve reached a point where our VM has the complete,
correct semantics.</p>
<p>But, also like last chapter, it&#x27;s pretty slow. Again, we&#x27;re heap allocating an
ObjBoundMethod for each super call even though most of the time the very next
instruction is an <code>OP_CALL</code> that immediately unpacks that bound method, invokes
it, and then discards it. In fact, this is even more likely to be true for
super calls than for regular method calls. At least with method calls there is
a chance that the user is actually invoking a function stored in a field. With
super calls, you&#x27;re <em>always</em> looking up a method. The only question is whether
you invoke it immediately or not.</p>
<p>The compiler can certainly answer that question for itself if it sees a left
parenthesis after the superclass method name, so we&#x27;ll go ahead and perform the
same optimization we did for method calls. Take out the two lines of code that
load the superclass and emit <code>OP_GET_SUPER</code>, and replace them with this:</p>
<p>^code super-invoke (1 before, 1 after)</p>
<p>Now before we emit anything, we look for a parenthesized argument list. If we
find one, we compile that. Then we load the superclass. After that, we emit a
new <code>OP_SUPER_INVOKE</code> instruction. This <span name="superinstruction">superinstruction</span> combines the behavior of
<code>OP_GET_SUPER</code> and <code>OP_CALL</code>, so it takes two operands: the constant table index
of the method name to look up and the number of arguments to pass to it.</p>
<aside name="superinstruction">
<p>This is a particularly <em>super</em> superinstruction, if you get what I&#x27;m saying.
I... I&#x27;m sorry for this terrible joke.</p>
</aside>
<p>Otherwise, if we don&#x27;t find a <code>(</code>, we continue to compile the expression as a
super access like we did before and emit an <code>OP_GET_SUPER</code>.</p>
<p>Drifting down the compilation pipeline, our first stop is a new instruction.</p>
<p>^code super-invoke-op (1 before, 1 after)</p>
<p>And just past that, its disassembler support.</p>
<p>^code disassemble-super-invoke (1 before, 1 after)</p>
<p>A super invocation instruction has the same set of operands as <code>OP_INVOKE</code>, so
we reuse the same helper to disassemble it. Finally, the pipeline dumps us into
the interpreter.</p>
<p>^code interpret-super-invoke (2 before, 1 after)</p>
<p>This handful of code is basically our implementation of <code>OP_INVOKE</code> mixed
together with a dash of <code>OP_GET_SUPER</code>. There are some differences in how the
stack is organized, though. With an unoptimized super call, the superclass is
popped and replaced by the ObjBoundMethod for the resolved function <em>before</em> the
arguments to the call are executed. This ensures that by the time the <code>OP_CALL</code>
is executed, the bound method is <em>under</em> the argument list, where the runtime
expects it to be for a closure call.</p>
<p>With our optimized instructions, things are shuffled a bit:</p>
<img decoding="async" loading="lazy" src="image/superclasses/super-invoke.png" class="wide img_ev3q" alt="The series of bytecode instructions for calling super.finish() using OP_SUPER_INVOKE.">
<p>Now resolving the superclass method is part of the <em>invocation</em>, so the
arguments need to already be on the stack at the point that we look up the
method. This means the superclass object is on top of the arguments.</p>
<p>Aside from that, the behavior is roughly the same as an <code>OP_GET_SUPER</code> followed
by an <code>OP_CALL</code>. First, we pull out the method name and argument count operands.
Then we pop the superclass off the top of the stack so that we can look up the
method in its method table. This conveniently leaves the stack set up just right
for a method call.</p>
<p>We pass the superclass, method name, and argument count to our existing
<code>invokeFromClass()</code> function. That function looks up the given method on the
given class and attempts to create a call to it with the given arity. If a
method could not be found, it returns <code>false</code>, and we bail out of the
interpreter. Otherwise, <code>invokeFromClass()</code> pushes a new CallFrame onto the call
stack for the method&#x27;s closure. That invalidates the interpreter&#x27;s cached
CallFrame pointer, so we refresh <code>frame</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-complete-virtual-machine">A Complete Virtual Machine<a href="#a-complete-virtual-machine" class="hash-link" aria-label="A Complete Virtual Machine的直接链接" title="A Complete Virtual Machine的直接链接">​</a></h2>
<p>Take a look back at what we&#x27;ve created. By my count, we wrote around 2,500 lines
of fairly clean, straightforward C. That little program contains a complete
implementation of the -- quite high-level! -- Lox language, with a whole
precedence table full of expression types and a suite of control flow
statements. We implemented variables, functions, closures, classes, fields,
methods, and inheritance.</p>
<p>Even more impressive, our implementation is portable to any platform with a C
compiler, and is fast enough for real-world production use. We have a
single-pass bytecode compiler, a tight virtual machine interpreter for our
internal instruction set, compact object representations, a stack for storing
variables without heap allocation, and a precise garbage collector.</p>
<p>If you go out and start poking around in the implementations of Lua, Python, or
Ruby, you will be surprised by how much of it now looks familiar to you. You
have seriously leveled up your knowledge of how programming languages work,
which in turn gives you a deeper understanding of programming itself. It&#x27;s like
you used to be a race car driver, and now you can pop the hood and repair the
engine too.</p>
<p>You can stop here if you like. The two implementations of Lox you have are
complete and full featured. You built the car and can drive it wherever you want
now. But if you are looking to have more fun tuning and tweaking for even
greater performance out on the track, there is one more chapter. We don&#x27;t add
any new capabilities, but we roll in a couple of classic optimizations to
squeeze even more perf out. If that sounds fun, <a href="/docs/Craftinginterpreters/not-translated-yet/optimization.html">keep reading</a>...</p>
<div class="challenges">
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="challenges">Challenges<a href="#challenges" class="hash-link" aria-label="Challenges的直接链接" title="Challenges的直接链接">​</a></h2>
<ol>
<li>
<p>A tenet of object-oriented programming is that a class should ensure new
objects are in a valid state. In Lox, that means defining an initializer
that populates the instance&#x27;s fields. Inheritance complicates invariants
because the instance must be in a valid state according to all of the
classes in the object&#x27;s inheritance chain.</p>
<p>The easy part is remembering to call <code>super.init()</code> in each subclass&#x27;s
<code>init()</code> method. The harder part is fields. There is nothing preventing two
classes in the inheritance chain from accidentally claiming the same field
name. When this happens, they will step on each other&#x27;s fields and possibly
leave you with an instance in a broken state.</p>
<p>If Lox was your language, how would you address this, if at all? If you
would change the language, implement your change.</p>
</li>
<li>
<p>Our copy-down inheritance optimization is valid only because Lox does not
permit you to modify a class&#x27;s methods after its declaration. This means we
don&#x27;t have to worry about the copied methods in the subclass getting out of
sync with later changes to the superclass.</p>
<p>Other languages, like Ruby, <em>do</em> allow classes to be modified after the
fact. How do implementations of languages like that support class
modification while keeping method resolution efficient?</p>
</li>
<li>
<p>In the <a href="/docs/Craftinginterpreters/not-translated-yet/inheritance.html">jlox chapter on inheritance</a>, we had a challenge to
implement the BETA language&#x27;s approach to method overriding. Solve the
challenge again, but this time in clox. Here&#x27;s the description of the
previous challenge:</p>
<p>In Lox, as in most other object-oriented languages, when looking up a
method, we start at the bottom of the class hierarchy and work our way up --
a subclass&#x27;s method is preferred over a superclass&#x27;s. In order to get to the
superclass method from within an overriding method, you use <code>super</code>.</p>
<p>The language <a href="https://beta.cs.au.dk/" target="_blank" rel="noopener noreferrer">BETA</a> takes the <a href="http://journal.stuffwithstuff.com/2012/12/19/the-impoliteness-of-overriding-methods/" target="_blank" rel="noopener noreferrer">opposite approach</a>. When you call a
method, it starts at the <em>top</em> of the class hierarchy and works <em>down</em>. A
superclass method wins over a subclass method. In order to get to the
subclass method, the superclass method can call <code>inner</code>, which is sort of
like the inverse of <code>super</code>. It chains to the next method down the
hierarchy.</p>
<p>The superclass method controls when and where the subclass is allowed to
refine its behavior. If the superclass method doesn&#x27;t call <code>inner</code> at all,
then the subclass has no way of overriding or modifying the superclass&#x27;s
behavior.</p>
<p>Take out Lox&#x27;s current overriding and <code>super</code> behavior, and replace it with
BETA&#x27;s semantics. In short:</p>
<ul>
<li>
<p>When calling a method on a class, the method <em>highest</em> on the
class&#x27;s inheritance chain takes precedence.</p>
</li>
<li>
<p>Inside the body of a method, a call to <code>inner</code> looks for a method with
the same name in the nearest subclass along the inheritance chain
between the class containing the <code>inner</code> and the class of <code>this</code>. If
there is no matching method, the <code>inner</code> call does nothing.</p>
</li>
</ul>
<p>For example:</p>
<div class="language-lox codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lox codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">class Doughnut {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cook() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;Fry until golden brown.&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    inner();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;Place in a nice box.&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class BostonCream &lt; Doughnut {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  cook() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    print &quot;Pipe full of custard and coat with chocolate.&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BostonCream().cook();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This should print:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Fry until golden brown.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Pipe full of custard and coat with chocolate.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Place in a nice box.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since clox is about not just implementing Lox, but doing so with good
performance, this time around try to solve the challenge with an eye towards
efficiency.</p>
</li>
</ol>
</div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/jabberwocky238/jabberwocky238.github.io/docs/Craftinginterpreters/not-translated-yet/superclasses.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Craftinginterpreters/not-translated-yet/strings"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">strings</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Craftinginterpreters/not-translated-yet/the-lox-language"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">the-lox-language</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#inheriting-methods" class="table-of-contents__link toc-highlight">Inheriting Methods</a><ul><li><a href="#executing-inheritance" class="table-of-contents__link toc-highlight">Executing inheritance</a></li><li><a href="#invalid-superclasses" class="table-of-contents__link toc-highlight">Invalid superclasses</a></li></ul></li><li><a href="#storing-superclasses" class="table-of-contents__link toc-highlight">Storing Superclasses</a><ul><li><a href="#a-superclass-local-variable" class="table-of-contents__link toc-highlight">A superclass local variable</a></li></ul></li><li><a href="#super-calls" class="table-of-contents__link toc-highlight">Super Calls</a><ul><li><a href="#executing-super-accesses" class="table-of-contents__link toc-highlight">Executing super accesses</a></li><li><a href="#faster-super-calls" class="table-of-contents__link toc-highlight">Faster super calls</a></li></ul></li><li><a href="#a-complete-virtual-machine" class="table-of-contents__link toc-highlight">A Complete Virtual Machine</a></li><li><a href="#challenges" class="table-of-contents__link toc-highlight">Challenges</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>