<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://jabberwocky238.github.io/blog</id>
    <title>JW238 Site Blog</title>
    <updated>2024-11-04T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://jabberwocky238.github.io/blog"/>
    <subtitle>JW238 Site Blog</subtitle>
    <icon>https://jabberwocky238.github.io/img/cometik.webp</icon>
    <entry>
        <title type="html"><![CDATA[docusaurus正常打开方式]]></title>
        <id>https://jabberwocky238.github.io/blog/2024/11/04/docusaurus-usage</id>
        <link href="https://jabberwocky238.github.io/blog/2024/11/04/docusaurus-usage"/>
        <updated>2024-11-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[docusaurus客户端代码无法正常加载和构建的原因]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一客户端代码-client-code">一，客户端代码 client code<a href="https://jabberwocky238.github.io/blog/2024/11/04/docusaurus-usage#%E4%B8%80%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-client-code" class="hash-link" aria-label="一，客户端代码 client code的直接链接" title="一，客户端代码 client code的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-官方描述">1. 官方描述<a href="https://jabberwocky238.github.io/blog/2024/11/04/docusaurus-usage#1-%E5%AE%98%E6%96%B9%E6%8F%8F%E8%BF%B0" class="hash-link" aria-label="1. 官方描述的直接链接" title="1. 官方描述的直接链接">​</a></h3>
<p>如果你使用这个文档里的方法，你会被麻烦死</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://jabberwocky238.github.io/assets/images/image-0264d44929320d728c125e99e23e363b.png" width="1998" height="1024" class="img_ev3q"></p>
<p>而且他报错很有误导性</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-我的情况">2. 我的情况<a href="https://jabberwocky238.github.io/blog/2024/11/04/docusaurus-usage#2-%E6%88%91%E7%9A%84%E6%83%85%E5%86%B5" class="hash-link" aria-label="2. 我的情况的直接链接" title="2. 我的情况的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://jabberwocky238.github.io/assets/images/image-1-40e40d089f9e2cb284f68702276ab337.png" width="574" height="304" class="img_ev3q"></p>
<p><a href="https://jabberwocky238.github.io/snake">点击游玩</a></p>
<p>贪吃蛇小游戏，代码和组件放在page下面了，但是logic本身全部是client code，所以不能直接引入</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://jabberwocky238.github.io/assets/images/image-2-fabd2e0845bcdbde32e3484847641794.png" width="2064" height="2344" class="img_ev3q"></p>
<p>你现在可能会说：</p>
<blockquote>
<p>你没使用<code>&lt;BrowserOnly&gt;</code></p>
</blockquote>
<blockquote>
<p>你没使用<code>ExecutionEnvironment</code></p>
</blockquote>
<p>我现在告诉你这个代码没错，可以编译通过</p>
<p>解决方法是：</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://jabberwocky238.github.io/assets/images/image-3-0839816496a4357f04c07249af478623.png" width="1648" height="862" class="img_ev3q"></p>
<p>是的，<strong>默认情况下ts文件和js文件算client module</strong>。</p>
<p>你把他去掉就没事了...</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二mdx还是md">二，mdx还是md？<a href="https://jabberwocky238.github.io/blog/2024/11/04/docusaurus-usage#%E4%BA%8Cmdx%E8%BF%98%E6%98%AFmd" class="hash-link" aria-label="二，mdx还是md？的直接链接" title="二，mdx还是md？的直接链接">​</a></h2>
<p>直接用mdx会留下一个相当丑陋的<code>{/* truncate */}</code>，去不掉</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://jabberwocky238.github.io/assets/images/turncate-c1e31d54bcb782d812248a74de9903d1.png" width="965" height="597" class="img_ev3q"></p>
<p><code>mdx</code>唯一的好处是使用js块，而如果你不用js块，那些<code>mdx</code>支持的<code>magic comment</code>，<code>.md</code>也支持，所以直接<code>.md</code>就完事了。</p>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
        <category label="zh" term="zh"/>
        <category label="tech" term="tech"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[markdown上传知乎最佳实践]]></title>
        <id>https://jabberwocky238.github.io/blog/2024/11/02/zhihu-markdown-best-practice</id>
        <link href="https://jabberwocky238.github.io/blog/2024/11/02/zhihu-markdown-best-practice"/>
        <updated>2024-11-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[长期维护，变动多]]></summary>
        <content type="html"><![CDATA[<p>长期维护，变动多</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一图片处理">一，图片处理<a href="https://jabberwocky238.github.io/blog/2024/11/02/zhihu-markdown-best-practice#%E4%B8%80%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86" class="hash-link" aria-label="一，图片处理的直接链接" title="一，图片处理的直接链接">​</a></h2>
<p>知乎不能识别base64风格的markdown图片，不能通过这种方式上传，但是它可以识别github生链接和gitee生链接。</p>
<p>gitee有审查，可能会麻烦，但是简单容易debug的方式，就是上传gitee，把该图片的生链接找到，直接嵌入文件，实现单文件上传。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-举例">1. 举例<a href="https://jabberwocky238.github.io/blog/2024/11/02/zhihu-markdown-best-practice#1-%E4%B8%BE%E4%BE%8B" class="hash-link" aria-label="1. 举例的直接链接" title="1. 举例的直接链接">​</a></h3>
<p>我在gitee仓库里有一张图片：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">七草日花.jpg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>转换成https的gitee连接：</p>
<p><a href="https://gitee.com/jabberwocky238/jabberwocky238.github.io/tree/main/blog/2024-11-02-zhihu-markdown-best-practice/%E4%B8%83%E8%8D%89%E6%97%A5%E8%8A%B1.jpg" target="_blank" rel="noopener noreferrer">gitee仓库图片</a></p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://gitee.com/jabberwocky238/jabberwocky238.github.io/tree/main/blog/2024-11-02-zhihu-markdown-best-practice/七草日花.jpg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>转换成raw文件的连接：</p>
<p><a href="https://gitee.com/jabberwocky238/jabberwocky238.github.io/raw/main/blog/2024-11-02-zhihu-markdown-best-practice/%E4%B8%83%E8%8D%89%E6%97%A5%E8%8A%B1.jpg" target="_blank" rel="noopener noreferrer">gitee仓库raw文件</a></p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">https://gitee.com/jabberwocky238/jabberwocky238.github.io/raw/main/blog/2024-11-02-zhihu-markdown-best-practice/七草日花.jpg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>嵌入文件：</p>
<div class="language-md codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-md codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token url operator">!</span><span class="token url">[</span><span class="token url content">七草日花</span><span class="token url">](</span><span class="token url">https://gitee.com/jabberwocky238/jabberwocky238.github.io/raw/main/blog/2024-11-02-zhihu-markdown-best-practice/七草日花.jpg</span><span class="token url">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最终效果：</p>
<p><img decoding="async" loading="lazy" alt="七草日花" src="https://jabberwocky238.github.io/assets/images/%E4%B8%83%E8%8D%89%E6%97%A5%E8%8A%B1-0525c80ad1c835dc0ee288dd70178417.jpg" width="1136" height="640" class="img_ev3q"></p>
<p>同理可以转化成github版本，或者自建站。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">CHANGELOG<a href="https://jabberwocky238.github.io/blog/2024/11/02/zhihu-markdown-best-practice#changelog" class="hash-link" aria-label="CHANGELOG的直接链接" title="CHANGELOG的直接链接">​</a></h2>
<blockquote>
<p>created at: 2024-11-02T13:00</p>
</blockquote>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
        <category label="zh" term="zh"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[trojan使用记录]]></title>
        <id>https://jabberwocky238.github.io/blog/2024/11/01/trojan-gfw</id>
        <link href="https://jabberwocky238.github.io/blog/2024/11/01/trojan-gfw"/>
        <updated>2024-11-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[服务端(linux)]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithStickyNavbar_LWe7" id="服务端linux">服务端(linux)<a href="https://jabberwocky238.github.io/blog/2024/11/01/trojan-gfw#%E6%9C%8D%E5%8A%A1%E7%AB%AFlinux" class="hash-link" aria-label="服务端(linux)的直接链接" title="服务端(linux)的直接链接">​</a></h2>
<p><a href="https://github.com/trojan-gfw/trojan/releases" target="_blank" rel="noopener noreferrer">trojan download</a></p>
<p>首先下载trojan。</p>
<p>解压。</p>
<p>申请域名，要crt和key，这一步很重要。</p>
<p>config.json</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"run_type"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"server"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"local_addr"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"0.0.0.0"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"local_port"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">443</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"remote_addr"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"127.0.0.1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"remote_port"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"password"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token string" style="color:rgb(255, 121, 198)">"passwordpasswordpassword"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"log_level"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"ssl"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"cert"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/ubuntu/nginx/xxx.site_nginx/xxx.site_bundle.crt"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"key"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"/home/ubuntu/nginx/xxx.site_nginx/xxx.site.key"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"key_password"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"cipher"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"cipher_tls13"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_256_GCM_SHA384"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"prefer_server_cipher"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"alpn"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"http/1.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"alpn_port_override"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token property">"h2"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">81</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"reuse_session"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"session_ticket"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"session_timeout"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">600</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"plain_http_response"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"curves"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"dhparam"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"tcp"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"prefer_ipv4"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"no_delay"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"keep_alive"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"reuse_port"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"fast_open"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"fast_open_qlen"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token property">"mysql"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"enabled"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"server_addr"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"127.0.0.1"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"server_port"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3306</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"database"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"trojan"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"username"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"trojan"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"password"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"key"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"cert"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token property">"ca"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>tcp的reuse_port和fast_open，能开就开（需要内核支持，请看trojan文档），会极大增加体验感，否则tcp连接经常断，网站打开一半404了，谁都受不了。</p></div></div>
<p>除了需要改crt文件和key文件的位置以外。</p>
<p>改密码，密码可以有很多，<strong>一定要改，否则就是裸奔</strong>。</p>
<p>其他别动，什么都不动。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="客户端clash">客户端(clash)<a href="https://jabberwocky238.github.io/blog/2024/11/01/trojan-gfw#%E5%AE%A2%E6%88%B7%E7%AB%AFclash" class="hash-link" aria-label="客户端(clash)的直接链接" title="客户端(clash)的直接链接">​</a></h2>
<p>教程：</p>
<ul>
<li><a href="https://www.codein.icu/clashtutorial/#proxy-group" target="_blank" rel="noopener noreferrer">codein.icu</a></li>
</ul>
<p>config.yaml</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">mixed-port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">7890</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">allow-lan</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">bind-address</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"*"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> rule</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">log-level</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">external-controller</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"127.0.0.1:9090"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">dns</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">enable</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">ipv6</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">default-nameserver</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">223.5.5.5</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> 119.29.29.29</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">enhanced-mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> fake</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">ip</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">fake-ip-range</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 198.18.0.1/16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">use-hosts</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">nameserver</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">"https://doh.pub/dns-query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"https://dns.alidns.com/dns-query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">fallback</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"https://doh.dns.sb/dns-query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"https://dns.cloudflare.com/dns-query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"https://dns.twnic.tw/dns-query"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token string" style="color:rgb(255, 121, 198)">"tls://8.8.4.4:853"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">fallback-filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token key atrule">geoip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token key atrule">ipcidr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">240.0.0.0/4</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> 0.0.0.0/32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">proxies</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 小卡拉米</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> trojan</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 域名</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token number">443</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 密码</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token key atrule">udp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token key atrule">skip-cert-verify</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">proxy-groups</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 小卡拉米机场</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> select</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token key atrule">proxies</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">小卡拉米</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DOMAIN-KEYWORD,google,小卡拉米"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DOMAIN-KEYWORD,youtube,小卡拉米"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DOMAIN-KEYWORD,github,小卡拉米"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DOMAIN-KEYWORD,docker,小卡拉米"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DOMAIN-SUFFIX,poe.com,小卡拉米"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"DOMAIN-SUFFIX,local,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"IP-CIDR,127.0.0.0/8,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"IP-CIDR,172.16.0.0/12,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"IP-CIDR,192.168.0.0/16,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"IP-CIDR,10.0.0.0/8,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"IP-CIDR,17.0.0.0/8,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"IP-CIDR,100.64.0.0/10,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"IP-CIDR,224.0.0.0/4,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"IP-CIDR6,fe80::/10,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"GEOIP,CN,DIRECT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"MATCH,DIRECT"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
        <category label="zh" term="zh"/>
        <category label="tech" term="tech"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[自建VPN+DNS实现内网穿透和组网]]></title>
        <id>https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn</id>
        <link href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn"/>
        <updated>2024-10-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[MDX版本文章更好看，转载于知乎]]></summary>
        <content type="html"><![CDATA[<p><a href="https://jw238.site/blog/2024/10/27/setting-your-own-vpn" target="_blank" rel="noopener noreferrer">MDX版本文章</a>更好看，转载于<a href="https://zhuanlan.zhihu.com/p/3446441267" target="_blank" rel="noopener noreferrer">知乎</a></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>如果你只想要内网穿透，直接看 <strong><a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#%E4%B8%80%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81">前情提要</a></strong> 里的 <strong><a href="https://github.com/fatedier/frp" target="_blank" rel="noopener noreferrer">Frp</a>内网穿透</strong> 部分即可，如果你想要组网，可以只看 <strong><a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#%E4%B8%89wireguard">WireGuard</a></strong> 部分。</p></div></div>
<p>本篇文章涉及了自组网，VPN，内网穿透，内网设备互联，自定义域名解析，端口转发等内容。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一前情提要">一，前情提要<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#%E4%B8%80%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81" class="hash-link" aria-label="一，前情提要的直接链接" title="一，前情提要的直接链接">​</a></h2>
<p>上次我听说VPN还是在做违法的事情的时候, 实际上VPN全称为“Virtual Private Network”, 是一种通过公共网络建立私密网络的技术。虽然这个词被大家乱用为翻过GFW的工具, 但细数现在流行的工具, 比如clash, v2ray, trojan, 他们的侧重点都在伪装。而纯血VPN只需要考虑加密, 这也是我这篇文章主要讨论的内容。</p>
<p>我自建VPN的初衷并不是翻GFW, 而是我自己搞了一个迷你主机, 类似nas, 但是侧重计算。我有两台云服务器, 以前玩MC剩下的, 但是很显然, 这两台云服务器垂垂老矣, 满足不了我的需求, 而且太贵了。<strong>腾讯云, 你在吃人肉</strong>(二改：腾讯云真便宜，阿里你在吃人肉)。</p>
<p>所以我借助两台云服务器自带的公网IP, 就想先做个frp内网穿透。当然, <a href="https://github.com/fatedier/frp" target="_blank" rel="noopener noreferrer">frp</a>是非常简单的, 小学生水平, 你看两眼就能自己配出来。</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">frps.toml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">bindPort = 7000</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">frpc.toml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">serverAddr = "x.x.x.x"</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">serverPort = 7000</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[[proxies]]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">name = "mcs"</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">type = "tcp"</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">localIP = "127.0.0.1"</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">localPort = 23333</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">remotePort = 23333</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这样两个文件直接就能把内网的mcsmanager管理平台透出来, 公网开个23333端口就行了。类似的操作, 暴露游戏25565端口也是易如反掌的, 透udp也只是改几个字的事。</p>
<p>但显然, 这样做会导致<strong>很严重的安全问题</strong>, 你管理平台是暴露在公网的, 别人随便点进来就能用, 很容易被搞。另外, 这是游戏服务器, 自己玩也就还好, 如果是企业级的需求呢？家庭需求呢？私密度更高的数据呢？于是我想到了我的校园网。</p>
<p>天津大学的校园网可以用easy connect连进VPN, 然后访问内网设施。我想的就是类似操作, 自己建一个VPN, 连进来才能访问mcs管理界面和其他东西。于是我开始沿着这一条路走到黑了。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二openvpn">二，OpenVPN<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#%E4%BA%8Copenvpn" class="hash-link" aria-label="二，OpenVPN的直接链接" title="二，OpenVPN的直接链接">​</a></h2>
<p>首先想到的是IPsec和PPTP, 因为这是AI告诉我的技术, 但是经过一番查找, 我发现那玩意已经过时了, 似乎也找不到一键启动的脚本, 于是我继续找, 找到了大名鼎鼎的<a href="https://github.com/OpenVPN/openvpn" target="_blank" rel="noopener noreferrer">OpenVPN</a>。</p>
<p>这个玩意是典型的C/S架构, 理解起来不难, 就是配置比较有旧时代风格, 可以看到这玩意是C语言写的, 配置也是足够的GNU style（<strong>纯脚本咔咔干啊...</strong>）</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>接下来所有操作系统都基于ubuntu20.04</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-init">1. init<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#1-init" class="hash-link" aria-label="1. init的直接链接" title="1. init的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install openvpn easy-rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我的习惯是把配置文件全都软连接搞出来用vscode看, 接下来就是实现这一步.</p>
<p>把easy-rsa全透出来:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /usr/share/easy-rsa ~/easy-rsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo chmod -R 0777 ~/easy-rsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ubuntu@VM-4-2-ubuntu:~/easy-rsa$ ll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 28</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">easyrsa -&gt; /usr/share/easy-rsa/easyrsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vars.example -&gt; /usr/share/easy-rsa/vars.example</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里只有vars和easyrsa需要用到, 别的完全忽略即可.</p>
<p>然后复制一份var, 现在跟着我填表即可, 内容照抄即可:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp ~/easy-rsa/vars.example ~/easy-rsa/vars</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo vim ~/easy-rsa/vars</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_CA_EXPIRE	3650</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_CERT_EXPIRE	1080</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Choices are:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#   cn_only  - use just a CN value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#   org      - use the "traditional" Country/Province/City/Org/OU/email/CN format</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_DN	"cn_only"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_COUNTRY "CN"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_PROVINCE "Beijing"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_CITY "Shanghai"</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_ORG "fuck" # 组织名</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_EMAIL "fuck@fuck.com" # 邮箱</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其他配置我也没动,基本上不重要. 接下来按流程敲命令即可,里面会有交互,注意注释详解.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 初始化pki (Public Key Infrastructure，即公钥基础设施，它是一个用于管理和分发加密密钥的系统)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa init-pki </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成ca证书，类似https的s，用于验证服务端身份</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 一直回车，生成ca.crt和ca.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa build-ca nopass </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成dh证书，我不知道用来干嘛的</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> # 一直回车，生成dh.pem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa gen-dh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成服务端密钥对</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成 pki/issued/vpn-server.crt 和 pki/private/vpn-server.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa build-server-full vpn-server nopass </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成客户端密钥对，每次派发一个新的客户端都需要制造证书，也可以直接复用原来的证书</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成 pki/issued/vpn-client.crt 和 pki/private/vpn-client.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa build-client-full vpn-client nopass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看 pki/issued/ 和 pki/private/ ,会发现多了证书和私钥出来：</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUEAAAEBCAYAAADmVhddAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAABhaVRYdFNuaXBNZXRhZGF0YQAAAAAAeyJjbGlwUG9pbnRzIjpbeyJ4IjowLCJ5IjowfSx7IngiOjMyMSwieSI6MH0seyJ4IjozMjEsInkiOjI1N30seyJ4IjowLCJ5IjoyNTd9XX0cJ/+3AAAgmklEQVR4Xu3dfWxb530v8G8iyy84gWwhuohgRANMXiTUhrI3iazOgQPwKoUR3AmoWA8QkCDoArpA7GDS6jJum2IyY9w07coqoIbaXSutHXJhgMASsgD7j4aqBGZkm8IGdwxaGclIG1aQKIvudaP6xHYN4d7nOS/kcw4piXqzRD3fT3FiHvLw8NCAv33eeH73dHZ2/j8QETW5+++/Hzdu3HD2Gnev8ycRkZYYgkSkNYYgEWmNIUhEWmMIEpHWGIJEpDWGIBFpjSFIRFrbUSEYG8shNxZz9uo4kUIul0aiz9knIu2xJUhEWtv4EAzFkHxtCI8bzv4yjC++hAt/8yxCzv6mGx9Gf/8gElPOPhFpb8ND0LgxhxsdxxD/wfJBaHwxjrFTj+O+Tz/GrPMcEdHdtuEhaH7wCyS+dgFFY+kgtAMwgt2/HsPzr0zCdJ5fUl8CaWssL4LExRxyOWdbbvxPiIykrePSIxH7CWtMMIXl30VEOtmcMcF5EYTPj9UNQrcFiH9pMAArDPScPim6tP2iSyu3DEqB6NJBKAIv3gsURvsxeC7vPElE5LV5EyPmZE0QGkeGkLQC8EcY+v5qAtBWyqrjeRMYzpaAQLi2ZSdbfANB3/FERLU2LwQlJwgLe2UQppB8UXRLf5VcUwCKk+F62XnoKl8Xz3aiS13y0nEMaSsA+zE87jxHRLSEzQ1BSQThd14QQdjaiT+IAIz/7VtrCMDV6zzojAMSES1j80NQkkEYG8TwBgdg5Gg3jIUZ5NUu7/wkBkcLQG+8OiFCRLSEuxOCG0JOjCgzu30JnOw1YF7Oo2baYyrBICSihjRRCJooZK/jmLs85nQPMJ1ceuZXBmG2BEMEYe5iAoxCIqqnOQotyXWCp7sxM8rZXiKqj4WWiIjWgCFIRFpjCBKR1lh8nYh2BI4JEhGtAUOQiLTGECQirTEEiUhrDEEi0hpDkIi0xhAkIq0xBIlIawxBItLa9glBw0ADpYqJiDbUNgnBEGKv/j1efy129wqxb5VmLPtplTzNIXXC2V+RXRqVN7SlZrBNQvAyJs7nUD4YxXd0CEIi2ja2T3f48uuIn01bQfhy8tltFoQxpFbVEtph5F26+1m9j3am7TUx4gThbNfgNgxCItqJtuettELPIvnyIB4oTeCVlzKis7wacjwqjp42Z1dQaxBHRtKI91anYDz1id3b+Gdn0D3QAwMlZLJAdCDoHGCrvMcp8l5RzqB/aMLZWYL1HiDTX0Q4F4X7brNSL8W+/u7L/vopsjUaBRqopxwbyyEacHaE2u8ov5vDc83uZ2cwE4paf4fWe8u15Q38f4/V65eW+g5Em2dn3UrLahFO4FpXDN/+9moG12VQiACcF/+wRffN2rIl5zXnH25oBkn3tdECOgf83VwDPX3ABeuYYUyMD4s/MyIO7UCQ77MCRYbJQCcKo865nGMaE0Q0F0ZRuY5qZbw88pdNGKGIiBLFibB4VwnFFQJQfsdoR6H6HZXvX63V4rzWn0ShI4rcmHeaxug9Bozbx9QP3Jj4jEnnHGJzrl/b4QJqatszBBWG8YDzaGWRkWMILogAUFtjIsTsf8jiH24vUBhPVEt0TiUwWRaRFPaGQEk8v2L7JdAu4nIOs5XCTxMYXqkVWGGK8BQB6+zJ67gwXQ2+/LlJlNq6ERFh7IqFg6K1lam+ZwnBDtE6m5+tXn/l+4tziNYtpi8oxary4rEIyUBY/O0oypMrFLTyfdepPGYWWPCemtP2DEHRFXvl2zF0X8/gpZfSzpMrkwFQtw6x1NeFTtnKO+2U7HQ2tdtoM3FdBOOKxjMoLMgW3VqWgqjhact/OAe0tTvd4wkUywa6j7rnjSEcMDFzaeWu5US2ADMgWne5NBJKiMoualeHbOXFPd/f0513mPONtGntySL7PN7hB6Jmsv1CUA1A0dpY3XjgSkrIuF04dWu4BacSrain5fszmHOCZSPXxU0US9UusewKr9g6czgzuf3ZOSfwvWHodum9m9IqbYDscuec8Un7/aJbLVqCRM1oe4XgOgOwNF9nLM01NSvaX0GEN3zcSnQNRRAkle7sWsjuLsrFahjJlibsLrF8rVRcZVBbY5kynNwWZR6z87Vd/9UT3zEkWtzTySXGC4may/YJwQ1oAdpjaT2IqwP9J1LOgL3sYooQGPD+WiMykvJ1G+sp4bp/zKty3rUQ3eiLiWpginPJbrk36OQECUSAJURXeOUJEVdsbOlfo8jWJURX2XPdfQmkVtWCtcPU6Kh2oyMjJ9kdpqa1TULwAcT+UgZgDi9/az1dYNkqy6BkjYm5Y16oBMjEUD8yZXscz3093lFsoJtpTyC442luiAQHlPPIWeenG5hQsYhu+VQ74s575bicZxmLI39pBujtQWcDEyJV6vfzLVORrcNsyXPdudPtKK5yGcvEkPfv+CQm2R2mprV91gka7WjHdVw3nX1SlrRU1+cRUX1rXSfIusMbzL+IuEoui1ldmFXWNaotTP9iZ4V3wTKRXhiCO07jvxAhIhZf31Hkz97kEpROzsASbTq2BIloR2BLkIhoDRiCRKQ1hiARaY0hSERaYwgSkdYYgkSkNYYgEWmNIUhEWmMIEpHWGIJEpDWGIBFpbWeFoLzNVM5fQnObsa7RXwSJiLYKW4JEpLWtC8FQDMnXhvB4vbuD+hhffAkX/uZZhJz9JTmV1nj7KSJq1JaFoHFjDjc6jiH+g+WD0PhiHGOnHsd9n36MWec5IqKNsrX3E+z4MyReO4mwOYnk18fwlq++iB2AEez+9Rief2USK5YfqVOTQ96gVC2wXi1oFEHiolo0vHr7e+u29h2T3nrEdet92Hd/rtRdWyjUFFvy3m5ffEZ2Bt0DrBtCtNGa836C879A4vkxFI3aFqHbAsS/NBiAdcgAinaIYHKLjGdLzisyHEUAzmec4uGybvCc80qjqre/d8+Rme9BXCmlaQfgnFLwfRLtA/XrgxDR1tj6iRHRCvQHoXFkCEkrAH+Eoe+vLQClYIc42fxstWU2PlxpBXZ1iI+er4Zi/tzwKosgHUOwnPGMP05kCzDb7ILpMiSjogVYyg4r5TInMDwqjnH2iGjrbY/ZYScIC3tlEKaQfFG0pX6VXFcASlYoWfVx/UtS1DrCSxcrX44VsGp9Y7mpVeD6utCJxoumE9HW2B4hKIkg/M4LIghbO/EHEYDxv31r/S0mZ7a4PzuHntMyqJQwlIXIxWvJ6U6nWPnqw1CWuHS7wtWNY31EzWT7hKAkgzA2iOGNCECVFXhJFBYMdB91R+xs+XOD4rWMaLMFEVYXWXd0Vcb2LIF2z1head6EEYp4j6nhO6fkOw8Rba3tFYIbLDa2VOsugsRYdQLDL39pBmZbD6KVAIshNVCZA7a4x5wcUc8ijhtzPlG0QifLIgYH1GuoPQ8Rba2dVXLTt4zFvzxGdl8Hz8lpEv/yGHXpjM27tKWEzOh1HPMvkbE+T53trS6zcXmvYYnzENG6rXWJDOsOE9GOwLrDRERrwBAkIq0xBIlIawxBItIaQ5CItMYQJCKtMQSJSGsMQSLSGkOQiLTGECQirTEEiUhrDEEi0lpTh6ARYoYT0fo04V1kWhA480fof+wA9sjdxZso/1MJb/z0jvUqEelJm7vIHDwTxHEZgLcWcG12ASb2IfDUwzj+zMZ9FXkPwJx7c1TB2leqyBHRztFkIWjgcNgAzI+QPlVCOl7C+bNX8CFaETiyH/udo4iIGtVkIXgv9raKPz4xcc0tQvL+Z/j49+LPvbvs7vEmmBjqR7+vqPr6ybtb55D23J5/Y8i7YrPlStQYziwQkdaaZGKkFU+kHsIjB+7BHtkUXLyD23eql92ydzd2YRG3by0CV69i7GwjteqWrjNi1QVBBv1Ddtl0/77krUHiq1FSqXUyifbTUbillSo1Tmpqk6j1T/xWvs6M+K+sY2JO/wIzoT/zHIuFApIb3ool2n52+MSICD9jtx2AUkureCz37W2X/aSz38hXiiGVE8EyL4LNrRecLTmvrcwKwNAMku57RwvoHMgh5SmvaaDndBhF5fxG70m77rFVD1mWALXDT75ePwAbuM5AFOGi/drguQtIPC1rKYv/E5DhJ49nABItS8vucGTkGIIyJJSWnaxNrFabW1oM0V6gMK6Ei1teM+wt8FnKDqPyCeOZunWPl9PQdYrXMw1dNxHVo2UIBjsMmJfza2sh9XWh02rl5ZDLVTe1tKfNxHURjOvR0HXOz7KlR7QOnBhZkxIybvdU3dQWGxE1BS1DsDRvwghF1raEZGoWcwgi7Bn/2xzruk4iaoiWIZg/N4lSWw/iyq9CcCLlm9hYygSKcvxvIAV1BDAykrInPRqWx+w8YHS4c8eSnAiprh1c63XmP5wD2tors9JEtLQmCcE/4J+TRfz4lQa2v5Mrp1cygeH+DEqBaHVcbwAoNjjBIBdPZ8pBRN33ii3eUURiyjmgQRPZAkznGuovml7jdVqTMM71cdE00bKa8AYKRES1tLmBAhHRRmIIEpHWGIJEpDWGIBFpjSFIRFpjCBKR1hiCRKQ1hiARaY0hSERaYwgSkdYYgkSkNYYgEWmNIUhEWmvqEDRCzHAiWp8mvJVWCwJn/gj9jx2wi60v3kT5n0p446d3rFeJSE/a3Err4JkgjssAvLWAa7MLMLEPgacexvFn2CokotVrsuQwcDhsAOZHSJ8qIR0v4fzZK/gQrQgc2Y/9zlFERI1qshC8F1b99U9MXDPtZ/D+Z/hY3lF/7y67e0x12LVLGquhQqQX9iGJSGtNMjHSiidSD+GRA/dgj2wKLt7B7TvVy27Zuxu7sIjbtxaBq1cxdtZtJi4tNuYtmF7K9mO4UsBItpyi1WptCwUkn05Uipxb70VG/C9qncMsl4HAA5gZHfQWWzqRsgojZfqHYVUk7ksgfbpHdOod5YxSqziCxMU4ui9nMBOKoqfNf00K67xKLTn3+qzzd2MmO4PuAfk5JWSyQFQ9VljyvERNbIdPjIjwM3bbASi1tIrHct/edtlPOvsrf6XISBrRDhEcbtH0bMl5RbIDECIo3KLqmfkexP1V2wJRhIv264NDb2JmwUD3UfUIEWp9QZjTGSUARUCNuudNotARRU4tpykYvceAcfuYekElrz030ImCep5550WLgZ4+4IL1mgjf8WHxZ0bEoR1+S52XSFdadoeDHaItNj9badlBBIUbDJGRYwiKFpoaFFZpzLZuRNS6wqL1lakck0f+sq9Qel8E3W0mZi7ZnxITLTNMX1BainnxWERTIOypX4zy5DKlO2OI9or2XVZtcYrzDFVbqVJpyrtPREvTMgSr9X7TNQXTrYBU6/zKTe3CutQQFexC6dWgjBzthlEJtAi6OmQrL+49r6+bKpnzaqvUp68LnaJNt3zdYRPXRe+ciBqj58SIaCkNyu5idg49p2UgecPQnE46XU1184331ZhAsex2iUWLMCRabEV3vM/mdke9mzNeSERbQs8QdFnjZUkUlPG80ryvW7sKE8WS/V6rK6y22PKYnRetzLB3/G/VpmYxhyDCXOpCtGG0DMHYWMo7DqfIX5qB2daDkyNqDMaQ8k1g1DWeQQHdiA50A+6EiEMGpOxme9bq9SWQ8nxOLWsiJOde7wQy0yaCA2rLNYLEmG/SpkYJ1xeAzoNriXaina1pfju8J9SCvbudneXcWMSnK4yJ+ZfHyO7v4DllhM+/lAUmCsryF3eJTHV5S5UMrXgvPMdX+Je2yCUsle6wu0TGey32+eaU49znlKtzr78yA738Z3OJDO1Ea10i04Q3UCAiqqXNDRSIiDYSQ5CItMYQJCKtMQSJSGsMQSLSGkOQiLR2zxe+8ASXyBBR07tx4/9yiQwR0WoxBIlIawxBItIaQ5CItMYQJCKtMQSJSGsMQSLSGkOw4lGc+t5r+OG3vuTsE5EOGIJEpDX+YmQTHX7+O/iLQ1fws2/8BG87zxHR5mi+X4wc+hLi3xjEf9vn7C9j35Hn8Nen/wcOOftERBtly1qC+x44iuf+6jgeuvmv+Nn30/jfN50XfPYdeRbfGnwUrb9N49yP/xVLHGbr/SqSXzmE8j/8I3D8WfzJfc7zH+Txwqs/d3aAL3/rNTyJPH6JCJ58ELj57uuI/wg49b1nEbjif/yO8y7pS/jmDyPA1Nfw3Teclt7nqilun0ceL8cXlc+Xbvy22iK0rvOPUXmn7/qIaPWariV48+NLOP+9N/Devj/FX7xYv0W4qgCs2Ic/+cqfA298DS+8ILc8Zh+M1E54iOcees8+xht00jt4+8pN7Dv0GA47z0iHn/8CukSY/VIEoAzEJ9v/zfkMsf3Db4HPPYtvHpevvYPz3/gafvauuGIZfvJ1TwDKoHbe98Lr+M2BOtdHRHfF1k6M/E4E4bl03SC0A/BzwL+vJgBts1Mv4fy0s4Of47tTH4jQ+6/4svOMpRJm9b39zhXcvO8QDvc6T4jW3eFD+3Dzyq+d8T1xXrX1Nv1rlMX/CXX8l0edJ+r78pN/DLz7j8r1icCcrnN9RHRXbP3ssOgO+4Nw3+cHEbcC8E28+tPVBaA4IRZmnYeu2QXx7P3orASa8Lv/XH6yYvoneOuDfQg86oRa72MI3PcB3qrpHr+GH1qbr/tb16PoPCC+n2gx2u9xtj7RJyeiLbE9lsg4QfibPTIIv474c4+JEPpfawjAjfXmex9UusSHHz2EfR/8B960X7LGA3/ojA9WurUNDkfMVt6jbj+onJuI7p7tEYKSCMKf/E8RhLvuxx0RgMmLxQ0LQCvAblzB25UuaIPe+A/MWl1iuys8+57b/XW6xu++bk2QNO4dzP0O6HqI439E28X2CUFJBuHIS/juugJQTox8vTq+1vtVDH5OHctbjZ/jl+8CgSf/OwJQxxDtMNvX3uXsy5bhn9d0h9/+5P8A97WhepTdupSTMvYEikNc4zefX34skYg2x/YKwQ1xE7+ZWsDj7njbV+REhH+pS+PkBAkefBDwheibrzqzzs7nDOLfarvDb/xKPPcgnpTHfO+r9kzzGz/AC1MfoKvPuT7rGtvw3hqvj4jWZ2f9YqSy/ESdHSYiHbDGCBHRGjAEiUhrDEEi0hrvIkNEOwLHBImI1oAhSERaYwgSkdbu6ezs3PIxwUgkgnw+7+wREa3e/fffzzFBIqLVYggSkdYYgkSkNYYgEWmNIUhEWmvqEDRCzHAiWp8mTJEWBM4cwlD6EZx6+fN48WIIx59rdV4jIlqdpgvBg2eCOP7YAey5tYBrswswsQ+Bpx7G8We26qtEkLiYQ3ok4uwTUTNpshA0cDhsAOZHSJ8qIR0v4fzZK/gQrQgc2Y/9zlFERI1qshC8F3tlz/cTE9dM+xm8/xk+/r34c+8u7LGfISJqWBOOCRIRbZwm+e1wK55IPYRHDtyDPbIpuHgHt+9UL7tl727swiJu31oErl7F2Fm3mbgcOZYXR0+bsyuUsv0YHpePYkjloghaz0olZPqHMeHsednn6b6cxOA5+zvExnKIBtTzVZ+zmSiMDiIxJR6eSCE3gJrzR0bSiIdmkHw6Af6qmmhlO/y3wyL8jN12AEotreKx3Le3XfaTzn4jX0mGnAjA+Qz6+/vtLVtyXpMBFMb1Ued5sWXKQUQvJkTcrUyGVzQgQ9MXgFA/aw49p9NI9IkXx4siYoMIn7CPtUUQCRkwL+cZgESbTMvucGTkGIILBSSHlLbX+HAltPLnhu1WmmOiKAKyrV1pGdZntd56IVp5SquuL4FjMhQ9n5VBYcFA91EZqxPITJsIhmP2a1JfBN1tJUw6LUsi2jxahmCwY+VWlgy0XC5nbwMrxZ8QOukEoNPNdQXaYYj4jLrnsjZvNzx/aQZmICzap7bI0W4Y5eIS3W8i2kicGKkhu8o5ezyu0n2tdpWXYojNFP9tr4z7KWSr0z2XsrljiJjKY2bB7RLLrrAI0ywjkOhu0DIES/MirkIibJx9jxNh0W4T3ddVTkiYly9gUIRlcCCHlDq+V74Os60bETn+t6S8aD2K98ousewKYwZ5tTVJRJtGyxDMn5tEqa0H8TFlHO5Eyg4vGVroRFcltETL0NcdlhMduXoTJePDVqvRE4RWK89Azwnv8bGxVKX7a5ETJKJLnBBdYXBChOiuaZrb6+8JtWDvbmdnOTcW8WnZebyspZfB2BMcsoMrieezQFRZxmLN9naILq7VWqxdIlN5fzmDfmtCpHY5jjldPd5lL6OpXgcRNW6tS2RYY2QbqSylUWeSiaghrDHS9GIIywXWRQYg0d3EENwm3LWLGWetIhHdHQzBrdaXQFouyemdW/WMNBGtH8cEiWhH4JggEdEaMASJSGsMQSLSGkOQiLTGECQirTEEiUhrDEEi0hpDkIi01tQhaISY4US0Pk2YIi0InDmEofQjOPXy5/HixRCOP+cUYCIiWqWmC8GDZ4I4/tgB7Lm1gGuzCzCxD4GnHsbxZzbuq1g3TVVuuLrkTVQ3m/W7YqcqHRFtiiYLQQOHwwZgfoT0qRLS8RLOn72CD9GKwJH92O8cRUTUqCYLwXthlR7+xMQ1t776+5/h49+LP/fuwh77mQ03MdSP/g2/w4u823QO6ZG73r4kIkUTjgkSEW2cJrmVViueSD2ERw7cgz2yKbh4B7fvVC+7Ze9u7MIibt9aBK5exdhZt5m4nNq6H6Vsv1WA3X+b+3q3vffWIam+1yLH8k53Y2Z0Eu2nq3VMKnVFrNd7rDKdrno1R6rncWsZu3VRvHVIrOurlPo0q7WPT6SQU2qjuKxrlyVFef9C2kF2+K20RPgZu+0AlFpaxWO5b2+77Ced/Ua+kgwTEYDzItjcOsAN1BZ2VULEfe9oAZ3+Upsi4npOh1FUzm/0nrQnOaYSGOxPorBgh5+nBvGSZGiLAJTFm/wBKAO68jlz4nOdyRRZwU5Epl3P2CXrGq9cfJ5IF1p2h91b2SfVgkbjw9WW3LJiiPYChXGlFSVCbbIMu26wopRVWmDjGRF6BrqPrmUM0Gm1wnfNoqV4TFan83wP9XMmkJk2vdcl6xq3lTC5YugS6UHLEAx2rKMl1NeFTquVl0MuV92q3VGXiesNlf5cWfcJJwD93ddAu7iSIKLKdeRkC1fp4ucvzcAMhEV02yJHu2GUi57uMZHOODGyJnJMzul+qpvaItswcuTQBNralRrJCtmirXMtle61Vfzd7RLLrrBoxWYZgUQuLUOwNG/CCIlAcPZXZWoWczXjbJvJxMz4IDJl2eJLVVp0lvJ1mG3diCy7mDqPxFTJ7hLLrjBmkLcmWYhI0jIE8+cmUWrrQVz5VYicSfVObCxlAkU5/jfgDaTISGqVv+zIY3ZetPM61PadnLCpv3ZQrlWsCUKrlSe65ie8v2aJjfnCUk6QiC5xQnSFwQkRIo8mCcE/4J+TRfz4lQa2v5Mrp1cygeH+jAiGaHUsbQAoNljztxpI1bG4eEfRWcbSuIlsAaZzDY0smp4YkjPK9ufagS1aeU+L5yACXbmWY/MZ35ifDO4genrnOCFC5MOSm5qot9aRaCdhyU1aRgzhAFAqMgCJ/BiCGnDXRWYa7O4T6YQhuJNZt+LKId47hwx/IkdUF8cEiWhH4JggEdEaMASJSGsMQSLSGkOQiLTGECQirTEEiUhrDEEi0hpDkIi0xhAkIq01dQgaIWY4Ea1PE6ZICwJnDmEo/QhOvfx5vHgxhOPPOVXoiIhWqelC8OCZII4/dgB7bi3g2uwCTOxD4KmHcfwZPVqF8r6AOfWO2ES0Lk2WHAYOhw3A/AjpUyWk4yWcP3sFH6IVgSP7sd85ioioUU0WgvfCqr/+iYlrpv0M3v8MH8s76u/dhT32M0REDdOjD0lEtIQmuZ9gK55IPYRHDtyDPbIpuHgHt+9UL7tl727swiJu31oErl7F2Fm3mbg0q+aGUjC9lO3HcOXOy7LqW7Ra51fW9lVuSurW68iI/8pzmOUyEHgAM6OD3mJLJ1JWAadM/7Bd+Eje5PR0j1VJ2FJWa35EkLgYR/flDGZCUauAuveabP5aIZGRNOK9BszpZKXWsPucq3Ie6/O7V75Ooia0w+8nKMLP2G0HoNTSKh7LfXvbZT/p7K/8lWRIRDuUouXZkvOKZAcgRHC4hcwz8z2IX/SWtUQginDRKXQ+9KZV+rL7qHqECLW+oAgnp/JbJYDc8yZR6IjWTHIYvceAcfsYfwDWEOEV7wUK4pyeAAzNVL/baAGdA051OqdEp/c6xTcOi7gvFxmApCUtu8PBDtFKmp+t3m5+fLgSOFY9DtFCUwPIKo3pL3LuqdmRR/6yr6C7LHTeZmLmkv0psYEeYPqC0gKzi6IjEPbWCC5PNla602q9BUUrT23VxRCVoTiu3Ep/KoFJWSdZFl93PtNbeF4WYTJRyDICSU9ahmC13m+6pmC6FZBqPWK5qV1Ylxqigl3QvRqUkaPdMCqBFkFXh2zlxb3nFSHmZ86rrdIldBxD2gpAX2uxrwud4kp7TiufITa1228VYlcD/UQYwYUZ5BsJXqIdSM+JEdE6GpRdxeycExjeMJTja3aXVd1842g1ZIFzt6spWloho6bEpQyt2vOufRyu86C3W2srIVPzGWKrjD2q12l3hUvi70MNdCKd6BmCLtENtsbmlHGy0ryvW7sKE0Wnq2l1hUsoKt3l2Xm3S7oB5icxOFoARMsyPaJc6dQs5hBEWI7/LUO2hGF9R9kVVq+TSD9ahmBsLOUdh1PkL83AbOvBSTVcxNGpRn6lMZ5BAd2IDnQD7oSIQwak7GZbExSuvgRSns+pJSc6crk61ytbszVBKFt5ImwHvMdHRlLebr+cIBHXGRkRXWFOiJDmmqbk5p5QC/budnaWc2MRn4ogWI5/eYy6vMTiX8oCEwVlWYl/mYrKXp4iZ2zrdJ+dyYwq2XV1u8PuEhnvtdjnm6scV/PZ7jmVZTz+7+ddimNb9jqJmtBal8iw7rCmKktpWJSddgjWHaZVsCduzMt5BiBpjyGooxPyFyklTKpDAESaYghqRf4aRq5P7ERhlD+RI5I4JkhEOwLHBImI1oAhSERa2xbdYSKi9WJ3mIhoDRiCRKQ1hiARaY0hSERaYwgSkdYYgkSkte0TgoZRewt7IqJNtk1CMITYq3+P11+LiUe0Enm/QH+VOiJaC+D/A1Lq8mnmwn1pAAAAAElFTkSuQmCC" width="321" height="257" class="img_ev3q"></p>
<p>然后该生成的都生成完了基本上，开始openvpn上场：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成 OpenVPN 的静态密钥文件 ta.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 不生成也可以用，但是某些GUI会显示”不安全“，为了用户感觉”安全“，咱还是加上。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openvpn --genkey --secret pki/ta.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 将所有的配置文件都转移到etc/openvpn目录下面</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/ca.crt /etc/openvpn/server/ca.crt </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/dh.pem /etc/openvpn/server/dh.pem </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/issued/vpn-server.crt /etc/openvpn/server/vpn-server.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/private/vpn-server.key /etc/openvpn/server/vpn-server.key </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/ta.key /etc/openvpn/server/ta.key </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>重中之重，必须要<code>cp</code>而不能软连接！！！</p><p>openvpn不认软连接！你可以mv进去<code>/etc/openvpn</code>原始文件，之后再把它们软连接出来，但不能直接把文件软连接进去。</p><p>一定要确保<code>/etc/openvpn</code>下的文件是原始文件，而不是软连接。</p></div></div>
<p>然后创建一个<code>/etc/openvpn/server/check.sh</code>1`文件，作为用户密码验证的脚本：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">check.sh</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 密码文件 用户名 密码明文</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PASSFILE="/etc/openvpn/openvpnfile" </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 用户登录情况的日志</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LOG_FILE="/var/log/openvpn-password.log"  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TIME_STAMP=`date "+%Y-%m-%d %T"`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if [ ! -r "${PASSFILE}" ]; then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo "${TIME_STAMP}: Could not open password file \"${PASSFILE}\" for reading." &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CORRECT_PASSWORD=`awk '!/^;/&amp;&amp;!/^#/&amp;&amp;$1=="'${username}'"{print $2;exit}'    ${PASSFILE}`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if [ "${CORRECT_PASSWORD}" = "" ]; then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo "${TIME_STAMP}: User does not exist: username=\"${username}\",password=\"${password}\"." &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if [ "${password}" = "${CORRECT_PASSWORD}" ]; then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo "${TIME_STAMP}: Successful authentication: username=\"${username}\"." &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    exit 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo "${TIME_STAMP}: Incorrect password: username=\"${username}\", password=\"${password}\"." &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">exit 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>创建<code>/etc/openvpn/openvpnfile</code>文件，里面记录所有用户的密码和用户名，明文存储，示例如下：</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">openvpnfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">jw238 123123</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">jwserver ee##rr$$tt%%</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">jwphone ppp22ppp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-serverconf">2. server.conf<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#2-serverconf" class="hash-link" aria-label="2. server.conf的直接链接" title="2. server.conf的直接链接">​</a></h3>
<p>接下来设置服务端配置文件，创建一个配置文件如下，尽量在server文件夹里面创建，后面systemd方便操作。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd /etc/openvpn/server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo nano server.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到�剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个conf很有讲究，内容直接决定配置复杂度和效果，仔细看。由于文件太长，我这里放个连接，保证各位能拿到文件样本即可。</p>
<p>国内点这个
<a href="https://jw238.site/assets/server.conf.sample" target="_blank" rel="noopener noreferrer">server.conf</a></p>
<p>国外点这个
<a href="https://jabberwocky238.github.io/assets/server.conf.sample" target="_blank" rel="noopener noreferrer">server.conf</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-clientconfovpn">3. client.conf(.ovpn)<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#3-clientconfovpn" class="hash-link" aria-label="3. client.conf(.ovpn)的直接链接" title="3. client.conf(.ovpn)的直接链接">​</a></h3>
<p>client.conf是linux文件，client.ovpn是windows文件，安卓系统皆可。</p>
<p>为了方便派发，我们把所有东西，证书啊密钥啊什么的，全部放进一个文件。接下来是一个实例，你按照我的要求进行复制即可：</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>点击查看 client.conf/client.ovpn</summary><div><div class="collapsibleContent_i85q">
  <!-- -->
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># client指明这是个客户端文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 验证远程服务器有没有开启tls，如果你没开，就把这个注释掉</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">remote-cert-tls server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 失败无限重连</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resolv-retry infinite</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># tun模式</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dev tun</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 公网IP, 端口，UDP/TCP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># remote x.x.x.x &lt;port&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">remote 154.20.78.20 9999 # 已脱敏，放心</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">proto udp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 不主动拉取服务端路径，防止全部流量都走VPN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">route-nopull</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 限定10.8.66.0/24的流量经过VPN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">route 10.8.66.0  255.255.255.0 vpn_gateway</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 看好你的加密方法和压缩方法</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cipher AES-256-GCM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">auth SHA1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">;comp-lzo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 使用密码验证</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">auth-user-pass</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 不绑定固定端口，客户端都这样</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nobind</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 允许循环路由，要不然找不到家</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">allow-recursive-routing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;ca&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MIIDSzCCAjOgAwIBAgIUcRw0kjFHdfnkTB+HgIMAnkt61S0wDQYJKoZIhvcNAQEL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">一大坨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MDIzMDIzOTQ1WjAWMRQwEgYDVQQDDAtFYXN5LVJTQSBDQTCCASIwDQYJKoZIhvcN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END CERTIFICATE-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/ca&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;key&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCN2YkgCmIZB2Gu</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">一大坨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DyZJHquhNczvbk81E3Gd0tgpevGx3qwQO67VIAG6veRAX4nRgAJMPJ3Sw/Jv8Hhe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/key&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;cert&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MIIDoDCCAoigAwIBAgIRAIGOQYVP1w+kSGx66gpyH4owDQYJKoZIhvcNAQELBQAw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">一大坨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DwAwggEKAoIBAQCN2YkgCmIZB2GuDyZJHquhNczvbk81E3Gd0tgpevGx3qwQO67V</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END CERTIFICATE-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/cert&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">key-direction 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;tls-auth&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 2048 bit OpenVPN static key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN OpenVPN Static key V1-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">b28b01af792acedbd8faaf80ab4716e3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">一小坨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">f5e36f61f95697b3f800d712996259db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END OpenVPN Static key V1-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/tls-auth&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-启动">4. 启动<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#4-%E5%90%AF%E5%8A%A8" class="hash-link" aria-label="4. 启动的直接链接" title="4. 启动的直接链接">​</a></h3>
<p>直接命令行启动，不建议</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo openvpn --daemon --config server.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo openvpn --config server.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>systemd启动，更好</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start openvpn-server@server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl status openvpn-server@server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>systemd情况要注意，你的server.conf文件的名字，其实就是@后的名字，换言之，如果你的server.conf叫abcd.conf，那么在systemd启动时，命令行应该如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start openvpn-server@abcd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>linux客户端同理，windows客户端和android客户端直接用GUI更好。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-测试">5. 测试<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#5-%E6%B5%8B%E8%AF%95" class="hash-link" aria-label="5. 测试的直接链接" title="5. 测试的直接链接">​</a></h3>
<p>我的妈呀，好费劲啊，好复杂啊，卧槽...而且这玩意很丑你知道吗，你跟clash和v2ray的界面一比，简直丑爆了。但是架不住他设置全面，覆盖面广，重武器有重武器的好。</p>
<p>接下来咱们准备两台设备，一个电脑一个手机，都连到VPN上，电脑打开一个python flask web，手机访问其公网IP和端口。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">10.8.66.1 公网服务器</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10.8.66.2 电脑</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10.8.66.3 手机</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>电脑的flask开在0.0.0.0的5000端口上，手机浏览器访问10.8.66.2:5000应该是可以打开的flask页面的，同理即可穿透其他内网服务，比如其他设备的docker容器，mysql甚至是ssh，mcsmanager就更不在话下了。</p>
<p><em>哪怕MC本身都是可以穿透的</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三wireguard">三，WireGuard<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#%E4%B8%89wireguard" class="hash-link" aria-label="三，WireGuard的直接链接" title="三，WireGuard的直接链接">​</a></h2>
<p>有没有更方便的方法，直接“开VPN”即访问内网，关VPN即无法访问。于是我找到了<a href="https://www.wireguard.com/" target="_blank" rel="noopener noreferrer">WireGuard</a>。</p>
<p>配置极度简单，但是坏处是没法密码验证，必须每个客户端独立密钥对，管理起来会麻烦，但是GUI好看，官方定制GUI，而且Wireguard速度比OpenVPN快。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-单机配置">1. 单机配置<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#1-%E5%8D%95%E6%9C%BA%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="1. 单机配置的直接链接" title="1. 单机配置的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install wireguard</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 构建密钥对，记得管理好，容易乱</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># PUBLIC_KEY和PRIVATE_KEY替换成你喜欢的名字</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wg genkey | tee keys/$PRIVATE_KEY | wg pubkey &gt; keys/$PUBLIC_KEY</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://jabberwocky238.github.io/assets/images/image-1-a7bc82e606d7bf9e846847dd6681e77e.png" width="322" height="397" class="img_ev3q"></p>
<p>然后创建一个配置文件，内容如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo vim /etc/wireguard/wg0.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">wg0.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = 服务器密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 192.168.238.1/24</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># Wireguard监听端口，默认是51820</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">ListenPort = 51820 </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostUp = iptables -A FORWARD -o wg0 -j ACCEPT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostUp = iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostDown = iptables -D FORWARD -o wg0 -j ACCEPT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostDown = iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 你的DNS服务器，可以自建，不自建的话就注释掉</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">DNS = 192.168.238.1</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = 客户端公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 此机器内网IP，/32意思是子网掩码是255.255.255.255</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 换言之这玩意只有自己的IP作为子网</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 192.168.238.2/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 握手速度，不是必须的，一般写个30秒上下足够，如果要实时性高可以写更短</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PersistentKeepalive = 25</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>PostUp和PostDown里面的“wg0”是当前文件的名字，你可以随便取，但是要保持一致。</p>
<p>PostUp和PostDown是WireGuard的钩子，用于iptable，kimi一下iptable是什么吧，这是一个很牛的东西。</p>
<p>如果你不想费心思考虑iptable的原理，我可以简单解释这三句话啥意思：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 允许wg0接口的数据包进来，inbound</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PostUp = iptables -A FORWARD -i wg0 -j ACCEPT;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 允许wg0接口的数据包出去，outbound</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PostUp = iptables -A FORWARD -o wg0 -j ACCEPT;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 允许wg0接口的数据包出去，但是要做NAT，转换到eth0（实际网卡）的IP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PostUp = iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后你的电脑或者手机开一个wireguard，写如下文件：</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">client.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = 客户端密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 192.168.238.2/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 你的DNS服务器，可以自建，不自建的话就注释掉</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">DNS = 192.168.238.1</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = 服务器公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 192.168.238.0/24</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PersistentKeepalive = 25</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后192.168.238.0/24网段的所有主机你都可以访问了。测试方法同openvpn，开一个flask，手机访问，成功即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-内网设备互联">2. 内网设备互联<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#2-%E5%86%85%E7%BD%91%E8%AE%BE%E5%A4%87%E4%BA%92%E8%81%94" class="hash-link" aria-label="2. 内网设备互联的直接链接" title="2. 内网设备互联的直接链接">​</a></h3>
<p>如果你想要内网机器互联，不需要增加Peer，只需要在每台机器上配置好client.conf。</p>
<p><strong>举例：</strong></p>
<p>设备A公网，设备B内网，设备C内网，B与C互相不通，现在要使用A作为VPN网关，使得B与C互通。</p>
<p>假设A内网IP是10.99.0.1，B是10.99.0.2，C是10.99.0.3。</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">A.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = A密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 10.99.0.1/24</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">ListenPort = 51820 </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostUp = 略</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostDown = 略</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = B公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 10.99.0.2/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = C公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 10.99.0.3/32</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">B.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = B密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 10.99.0.2/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = A公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 10.99.0.0/24</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">C.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = C密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 10.99.0.3/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = A公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 10.99.0.0/24</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此三设备互相可以ping通，使用内网IP即可。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>如果三者其一开启网络服务，记得暴露在0.0.0.0网段或者指定在10.99.0.0/24网段，否则，一般的127.0.0.1，由于你没设置iptable，是访问不到的。</p><p>或者使用nginx进行反向代理，把localhost代理到内网网段，下文有所涉猎。</p></div></div>
<p>A的Peer设置里，10.99.0.0/24的意思是，只有10.99.0.0/24网段的流量会被此VPN接管，其他流量都是直连状态，不会接管。</p>
<p>换言之，如果你写<code>AllowedIPs = 0.0.0.0</code>，那么A就类似 <strong>“梯”</strong> 了。</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>wireguard可以做 <strong>“梯”</strong> ，但是诸多事件告诉我们，应该选择更安全的协议，wireguard并不能很好的隐藏自己，有兴趣可点我个人站，有你想看的。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-web-gui管理器">3. Web GUI管理器<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#3-web-gui%E7%AE%A1%E7%90%86%E5%99%A8" class="hash-link" aria-label="3. Web GUI管理器的直接链接" title="3. Web GUI管理器的直接链接">​</a></h3>
<p>wireguard的好处，比OpenVPN好的地方，就是他有一个开源的，非常好的webGUI，弥补了它没密码表不好管理的缺陷，github连接在这，<a href="https://github.com/ngoduykhanh/wireguard-ui" target="_blank" rel="noopener noreferrer">wireguard-ui</a>，占用空间也很小，2核2G的服务器绰绰有余可以跑这个，还能加上nginx，都吃不到20%。</p>
<p>使用方法，官方给出了直接使用版本，我的建议还是用docker，毕竟这玩意，在不久的未来可能需要多开，毕竟需要留一个只有你能打开的面板（防止管理人员不懂技术，搞坏了，你又不好debug）。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>对于已经在宿主机里装好wireguard的同学，恭喜你，你跟我完全一样，只需要顺着走完此教程即可。</p></div></div>
<p>docker-compose文件sample官方已经给了，我在这里给你一个我的副本，解释一下每个参数的意义，方便你使用。</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>点击查看 docker-compose.yml</summary><div><div class="collapsibleContent_i85q">
  <!-- -->
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">"3"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">wireguard-ui</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ngoduykhanh/wireguard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">ui</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> wireguard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">ui</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">cap_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> NET_ADMIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># required to show active clients. with this set, you don't need to expose the ui port (5000) anymore</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">network_mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> host</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> BASE_PATH </span><span class="token comment" style="color:rgb(98, 114, 164)"># web GUI基点，默认是"/"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># ！！！绑定GUI监听端口，也就是nginx转发的位置(proxy_pass http://127.0.0.1:23992;)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> BIND_ADDRESS=127.0.0.1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">23992</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SESSION_SECRET </span><span class="token comment" style="color:rgb(98, 114, 164)"># 额外加密</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SESSION_SECRET_FILE </span><span class="token comment" style="color:rgb(98, 114, 164)"># 额外加密</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SESSION_MAX_DURATION=90 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 额外加密</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># ！！！子网范围，仔细看文档，他直接决定此GUI的全局选项，且容器生命周期内不可修改，你可以删容器来重启</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SUBNET_RANGES=ALL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">192.168.238.0/24;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_USERNAME=admin </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认用户名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PASSWORD=admin </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认用户密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PASSWORD_FILE </span><span class="token comment" style="color:rgb(98, 114, 164)"># 密码很长的话可以放文件里</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PASSWORD_HASH </span><span class="token comment" style="color:rgb(98, 114, 164)"># 没懂</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PASSWORD_HASH_FILE </span><span class="token comment" style="color:rgb(98, 114, 164)"># 没懂</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_ENDPOINT_ADDRESS=xxx.xxx.xxx.xxx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">51280</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># wireguard公网IP和端口，内部可调</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_FAVICON_FILE_PATH </span><span class="token comment" style="color:rgb(98, 114, 164)"># 网站图标</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DNS=192.168.238.1 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 自定义DNS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_MTU=1450 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认设置1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PERSISTENT_KEEPALIVE=15 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认设置2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_FIREWALL_MARK=51280 </span><span class="token comment" style="color:rgb(98, 114, 164)"># wireguard公网端口，内部可调</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_TABLE=auto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># ！！！此GUI监管的wg示例，如果你填了wg1，那么那就会对wg1.conf完全控制，包括开启和关闭，甚至文件修改</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_CONFIG_FILE_PATH=/etc/wireguard/wg1.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_LOG_LEVEL=INFO</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WG_CONF_TEMPLATE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> EMAIL_FROM_ADDRESS=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> EMAIL_FROM_NAME=WireGuard UI</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SENDGRID_API_KEY=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SENDGRID_API_KEY_FILE=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># SMTP和TELEGRAM通知，你不设置就不用填，没用。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_HOSTNAME=127.0.0.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_PORT=25</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_USERNAME=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_PASSWORD=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_PASSWORD_FILE=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_AUTH_TYPE=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_ENCRYPTION=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_HELO=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> TELEGRAM_TOKEN=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> TELEGRAM_ALLOW_CONF_REQUEST=false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> TELEGRAM_FLOOD_WAIT=60</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认配置一大堆，注意POST_UP和POST_DOWN对应的wg1，名字别错了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_SERVER_INTERFACE_ADDRESSES=192.168.238.1/24</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_SERVER_LISTEN_PORT=51280</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_SERVER_POST_UP_SCRIPT=iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">A FORWARD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">i wg1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j ACCEPT; iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">A FORWARD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">o wg1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j ACCEPT; iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">t nat </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">A POSTROUTING </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">o eth0 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j MASQUERADE;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_SERVER_POST_DOWN_SCRIPT=iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">D FORWARD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">i wg1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j ACCEPT; iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">D FORWARD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">o wg1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j ACCEPT; iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">t nat </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">D POSTROUTING </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">o eth0 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j MASQUERADE;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DEFAULT_CLIENT_ALLOWED_IPS=192.168.238.0/24</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DEFAULT_CLIENT_EXTRA_ALLOWED_IPS=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DEFAULT_CLIENT_USE_SERVER_DNS=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DEFAULT_CLIENT_ENABLE_AFTER_CREATION=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># ！！！一定要true，让容器直接控制宿主机wg1启停</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_MANAGE_START=true</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_MANAGE_RESTART=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">driver</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">options</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">max-size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 50m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> ./db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">/app/db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> /etc/wireguard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">/etc/wireguard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</div></div></details>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四dnsbind9-named">四，DNS(bind9, named)<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#%E5%9B%9Bdnsbind9-named" class="hash-link" aria-label="四，DNS(bind9, named)的直接链接" title="四，DNS(bind9, named)的直接链接">​</a></h2>
<p>DNS服务器，用于解析域名。你连上自定义的VPN之后，内网的兄弟姐妹连你的服务还得手敲IP，多没面子！所以我们来搞一个DNS服务器，给他一个漂亮的域名，看起来就爽多了。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install bind9</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /etc/bind /home/ubuntu/bind</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后你会看到如下场景：</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="https://jabberwocky238.github.io/assets/images/image-3-873a43458e0a4f78c580b237250bdc17.png" width="566" height="481" class="img_ev3q"></p>
<p>首先复制一下db.local，然后改一个你喜欢的名字，像我一样，然后改文件。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">db.jw238server</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; BIND data file for jw.boom</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$TTL    86400</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; 这里写基础域名，据我所知你可以写的很骚，我这里非常保守，你可以写好长一串</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@   IN  SOA jw.boom. root.jw.boom. (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              1         ; Serial</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         604800         ; Refresh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          86400         ; Retry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        2419200         ; Expire</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         604800 )       ; Negative Cache TTL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; 默认nameserver，必写，我这里写的是station</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; 你可以直接解析到IP，或者像我一样隔一层</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@           IN      NS      station </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; A是解析到IPV4地址，AAAA是解析到IPV6地址</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">station     IN      A       192.168.238.1 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; CNAME是别名</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dns         IN      CNAME   station</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mcs         IN      CNAME   station</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mcworld     IN      A       192.168.238.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mc          IN      CNAME   mcworld</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gigachad    IN      A       192.168.238.5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; 下面两句必写，否则会报错</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@	        IN	    A     	127.0.0.1 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@	        IN	    AAAA	  ::1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后找到<code>named.conf.local</code>，加一行这个。</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">named.conf.local</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 定义域名的核心在这里</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zone "jw.boom" {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	type master;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	file "/etc/bind/db.jw238server";</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后找到<code>named.conf.options</code>，改写转发规则。</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">named.conf.options</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">options {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	directory "/var/cache/bind";</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // 不forward，因为你都解析不出来，那肯定就不是自定义的域名了 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	// forwarders { 8.8.8.8; };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	dnssec-validation no; // 关了不报错</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	listen-on port 53 { </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		192.168.238.1; // 本机内网IP，也是你的DNS服务器</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  listen-on-v6 { any; }; // 解析IPV6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	recursion yes; // 循环查询dns</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	allow-query { any; }; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后记得重启named(bind9)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl restart named</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果你的服务暴露在内网段，你已经可以通过域名+端口直接访问了，但是如果你想去掉恶心的端口，或者转发127.0.0.1的服务，就需要nginx。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="五nginx">五，Nginx<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#%E4%BA%94nginx" class="hash-link" aria-label="五，Nginx的直接链接" title="五，Nginx的直接链接">​</a></h2>
<p>咋装咋开：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /etc/nginx /home/ubuntu/nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /var/www/html /home/ubuntu/nginx/html</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /var/log/nginx /home/ubuntu/nginx/log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>分conf文件我就不教了，可以搜nginx教学，这里只教快速映射端口和域名。</p>
<p>找到nginx的http块。</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">nginx.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    map $http_host $backend_port {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        mcsmanager.jw.boom 23333;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        mc.jw.boom 25565;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        gigachad.jw.boom 6666;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        listen 80;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        location / {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            proxy_pass http://127.0.0.1:$backend_port;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>map格式，左边域名，右边端口，域名支持正则匹配。</p>
<p>下面server块，我还不知道怎么魔改，建议照抄。</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>这个server块和map块必须直接放在http块下，不能放入单独的conf文件引入，因为map块有作用域。</p></div></div>
<p>记得重启：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 重启之间测试一下配置文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo nginx -t</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 如果报错了，看看配置哪不对</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 重启</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl reload nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>至此，你在VPN服务器直接开一个mcsmanager，你的小伙伴应该可以通过mcsmanager.jw.boom来访问控制面板了。</p>
<p>然后同一个VPN下的同学可以直接通过内网IP加端口号访问对方的世界。</p>
<p>例如公网机器A(192.169.0.1)，同学B(192.169.0.2)，同学C(192.169.0.3)，其中B开了一个世界，局域网端口为48888，那么C可以通过192.168.0.2:48888连入世界。</p>
<p>或者如果你做了DNS，把192.169.0.2解析到了gigachad.jw.boom，那么C同学就可以通过gigachad.jw.boom:48888连入世界。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>如果B访问C的mcsmanager控制面板，需要在A里面做DNS解析，在C里面做nginx代理。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">CHANGELOG<a href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn#changelog" class="hash-link" aria-label="CHANGELOG的直接链接" title="CHANGELOG的直接链接">​</a></h2>
<blockquote>
<p>created at: 2024-10-27T18:00<br>
modified at: 2024-11-01T23:09</p>
<ul>
<li>补齐了dns和nginx部分</li>
<li>加入了wireguard web GUI</li>
</ul>
<p>modified at: 2024-11-02T12:03</p>
<ul>
<li>加上了导读</li>
<li>制作知乎版单文件，github仓库可见</li>
</ul>
<p>modified at: 2024-11-04T02:03</p>
<ul>
<li>codeblock 美化</li>
</ul>
<p>modified at: 2024-11-04T17:12</p>
<ul>
<li>details-summary 美化大块代码</li>
</ul>
</blockquote>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
        <category label="zh" term="zh"/>
        <category label="tech" term="tech"/>
        <category label="golden" term="golden"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[rust中变换递归为循环的必要性]]></title>
        <id>https://jabberwocky238.github.io/blog/2024/10/07/Recursive-and-Loop-rust</id>
        <link href="https://jabberwocky238.github.io/blog/2024/10/07/Recursive-and-Loop-rust"/>
        <updated>2024-10-07T01:45:00.000Z</updated>
        <summary type="html"><![CDATA[rust中变换递归为循环的必要性]]></summary>
        <content type="html"><![CDATA[<p>虽然现在已经凌晨一点45分但是这个技术点太牛逼了以至于我迫不及待地想要记录下来。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="递归会有所有权问题">递归会有所有权问题<a href="https://jabberwocky238.github.io/blog/2024/10/07/Recursive-and-Loop-rust#%E9%80%92%E5%BD%92%E4%BC%9A%E6%9C%89%E6%89%80%E6%9C%89%E6%9D%83%E9%97%AE%E9%A2%98" class="hash-link" aria-label="递归会有所有权问题的直接链接" title="递归会有所有权问题的直接链接">​</a></h2>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token type-definition class-name">JManager</span><span class="token operator">&lt;</span><span class="token class-name">H</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">N</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    nodes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">H</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">N</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">/// hash, children's hash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">H</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">HashSet</span><span class="token operator">&lt;</span><span class="token class-name">H</span><span class="token operator">&gt;&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 函数的作用是查出所有子节点并删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// 但是递归会导致所有权问题，以至于delete_node无法递归调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">impl</span><span class="token plain"> </span><span class="token class-name">JManager</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">delete_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">dyn</span><span class="token plain"> </span><span class="token namespace">std</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token namespace">error</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> chs </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ph</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// borrow immutable self</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token operator">!</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">nodes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">contains_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// borrow immutable self</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> ch </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> chs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">delete_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// borrow mutable self, panic!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token class-name">Err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Node not exist"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">into</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="循环可以避免所有权问题">循环可以避免所有权问题<a href="https://jabberwocky238.github.io/blog/2024/10/07/Recursive-and-Loop-rust#%E5%BE%AA%E7%8E%AF%E5%8F%AF%E4%BB%A5%E9%81%BF%E5%85%8D%E6%89%80%E6%9C%89%E6%9D%83%E9%97%AE%E9%A2%98" class="hash-link" aria-label="循环可以避免所有权问题的直接链接" title="循环可以避免所有权问题的直接链接">​</a></h2>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">impl</span><span class="token plain"> </span><span class="token class-name">JManager</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">delete_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">dyn</span><span class="token plain"> </span><span class="token namespace">std</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token namespace">error</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token operator">!</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">nodes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">contains_key</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token class-name">Err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Node not exist"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">into</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> to_delete </span><span class="token operator">=</span><span class="token plain"> </span><span class="token macro property">vec!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">clone</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// queue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">while</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> to_delete</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">pop</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// parent remove child</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ph</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">phash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get_mut</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">ph</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">remove</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// add children to queue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">chs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">get</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// 将子节点添加到待删除列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> chs </span><span class="token operator">=</span><span class="token plain"> chs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">cloned</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token plain">_</span><span class="token operator">&gt;&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                to_delete</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">extend</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">chs</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// 这里是对chash的可变引用，而不是self，所以不会报错</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token comment" style="color:rgb(98, 114, 164)">// 虽然我老感觉chash的引用有所有权问题</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">remove</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// **SAME EFFECT AS ABOVE**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// let chs = self.chash.get(&amp;h).unwrap();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// let chs = chs.iter().cloned().collect::&lt;Vec&lt;_&gt;&gt;();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// to_delete.extend(chs);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token comment" style="color:rgb(98, 114, 164)">// self.chash.remove(&amp;h);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">nodes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">remove</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这段代码让我想到了DFS递归版和循环版，太优美了。</p>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
        <category label="zh" term="zh"/>
        <category label="tech" term="tech"/>
        <category label="rust" term="rust"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Animate girls, ShinyColors.]]></title>
        <id>https://jabberwocky238.github.io/blog/2024/10/06/ShinyColor-1</id>
        <link href="https://jabberwocky238.github.io/blog/2024/10/06/ShinyColor-1"/>
        <updated>2024-10-06T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Do I have anything left?]]></summary>
        <content type="html"><![CDATA[<p>Do I have anything left?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="some-shit-talks">Some shit talks<a href="https://jabberwocky238.github.io/blog/2024/10/06/ShinyColor-1#some-shit-talks" class="hash-link" aria-label="Some shit talks的直接链接" title="Some shit talks的直接链接">​</a></h2>
<p>Alright. I have to claim that this blog is not tasteful and nutritious. So if any of you want to see some valuable pages, you should quit right now.</p>
<p>Good, then, I do admitted that I am still haunted by my next tofel exam. ETO is like a bitch, scraping my heart and brain everyday.</p>
<p>Therefore, I write this blog in English not because I want to, but I have to. There is a voice in my head keep telling me I need to do something related to English, or I will undoubtfully fail in the next round.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-this-essay-comes-into-existence">Why this essay comes into existence<a href="https://jabberwocky238.github.io/blog/2024/10/06/ShinyColor-1#why-this-essay-comes-into-existence" class="hash-link" aria-label="Why this essay comes into existence的直接链接" title="Why this essay comes into existence的直接链接">​</a></h2>
<p>Well, there are still something worth doing within this reluctant blog.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>You know what?</summary><div><div class="collapsibleContent_i85q">
<!-- -->
<p>I want to GPT my paragraphs in order to judge whether or not my grammar is right.</p>
<p>But Kimi has been disconnected 4 times and tells me my network is down.</p>
<p>Meanwhile, my codegeex agent integrated in vscode is working fine right now.</p>
<p>So Kimi is a bitch.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>You know what???</summary><div><div class="collapsibleContent_i85q">
<!-- -->
<p>"is a bitch" is automatically filled by codegeex! laugh out of my ass....</p>
<p>So for the sake of such a smart agent, i decide to find some <a href="https://www.emojiall.com/zh-hans/emoji/%F0%9F%A4%A3" target="_blank" rel="noopener noreferrer">emojis</a> to express my happiness right now.</p>
<p>🤣🤣🤣🤣</p>
</div></div></details>
</div></div></details>
<p>Alright, let's get back to the topic. What are worthy of doing?</p>
<p><strong></strong></p><center><strong>Translation of all girls' names.</strong></center><p></p>
<p>Sound stupid, but utilitarian.</p>
<p>Because of an obivious reason, Lao Wai cannot understand the girls' names in my language. But it is no denying that tremendous amount of them do watch animates, which means I can cut in the conversation through this topic.</p>
<p>Most importantly, it is not as evil as how brutal world and competition does, right?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="girls-groups-and-relations">Girls, groups and relations<a href="https://jabberwocky238.github.io/blog/2024/10/06/ShinyColor-1#girls-groups-and-relations" class="hash-link" aria-label="Girls, groups and relations的直接链接" title="Girls, groups and relations的直接链接">​</a></h2>
<!-- -->
<p><em>I won't tell you that the primary reason of writing this page is trying out mermaid.</em></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>The theme colors here are all wrong. But I cannot figure out how to stylize mermaid.</p><p>But I promise I will come back and correct it someday.</p></div></div>
<ul>
<li>illumination STARS
<ul>
<li>Mano Sakuragi (CV: Hitomi Sekine)</li>
<li>Hiori Kazano (CV: Reina Kondou)</li>
<li>Meguru Hachimiya (CV: Mayu Mineda)</li>
</ul>
</li>
<li>L'Antica
<ul>
<li>Kogane Tsukioka (CV: Karin Isobe)</li>
<li>Mamimi Tanaka (CV: Chisa Suganuma)</li>
<li>Sakuya Shirase (CV: Anna Yamaki)</li>
<li>Yuika Mitsumine (CV: Runa Narumi (2018-2021), Shio Kisui (2021-onwards))</li>
<li>Kiriko Yukoku (CV: Mizuki Yuina)</li>
</ul>
</li>
<li>Houkago Climax Girls
<ul>
<li>Kaho Komiya (CV: Hiyori Kouno)</li>
<li>Chiyoko Sonoda (CV: Haruka Shiraishi)</li>
<li>Juri Saijo (CV: Mariko Nagai)</li>
<li>Rinze Morino (CV: Wakana Maruoka)</li>
<li>Natsuha Arisugawa (CV: Akiho Suzumoto)</li>
</ul>
</li>
<li>ALSTROEMERIA
<ul>
<li>Amana Osaki (CV: Honoka Kuroki)</li>
<li>Tenka Osaki (CV: Ryouko Maekawa)</li>
<li>Chiyuki Kuwayama (CV: Noriko Shibasaki)</li>
</ul>
</li>
<li>Straylight
<ul>
<li>Asahi Serizawa (CV: Yuki Tanaka)</li>
<li>Fuyuko Mayuzumi (CV: Eri Yukimura)</li>
<li>Mei Izumi (CV: Sayaka Kitahara)</li>
</ul>
</li>
<li>noctchill
<ul>
<li>Toru Asakura (CV: Yuu Wakui)</li>
<li>Madoka Higuchi (CV: Rio Tsuchiya)</li>
<li>Koito Fukumaru (CV: Saran Tajima)</li>
<li>Hinana Ichikawa (CV: Miho Okasaki)</li>
</ul>
</li>
<li>SHHis
<ul>
<li>Nichika Nanakusa (CV: Azusa Shizuki)</li>
<li>Mikoto Aketa (CV: Aya Yamane)</li>
</ul>
</li>
<li>CoMETIK
<ul>
<li>Luca Ikaruga (CV: Rina Kawaguchi)</li>
<li>Hana Suzuki (CV: Haruna Mikawa)</li>
<li>Haruki Ikuta (CV: Rena Ozawa)</li>
</ul>
</li>
</ul>
<p>I am tired now. I have wrote this page for 2h...</p>
<p>At first, emoji webside, connection lagging, and then, stupid Claude, uncustomisable mermaid. Oh my gosh...</p>
<p>I have tons of pictures and voices about them, but today I shall get no time to share.</p>
<p>So now, it is time to narrate my story.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bwiki-i-worked-for-before">BWiki I worked for before<a href="https://jabberwocky238.github.io/blog/2024/10/06/ShinyColor-1#bwiki-i-worked-for-before" class="hash-link" aria-label="BWiki I worked for before的直接链接" title="BWiki I worked for before的直接链接">​</a></h2>
<p>In 2023/7-2024/4, I Joined in and worked for a team, which is built up by community members.</p>
<p>We create our website and deploy it on <a href="https://wiki.biligame.com/" target="_blank" rel="noopener noreferrer">BWiki</a> service, sharing some game strategies.</p>
<p>The <a href="https://shinycolors.enza.fun/home" target="_blank" rel="noopener noreferrer"><strong>Enza ShinyColor</strong></a> is a fully browser-based Japenese game. As a new comer, there is no doubt that you will be dazzled by massive items, characters, stories, cards, properties and their interactions. So we created a website, which is a wiki, to help people to navigate through the game.</p>
<p>The only motivation of us is to make ShinyColor better, more acceptable by more people.</p>
<p><strong>Not only are we obsessed by girls, but we are also obsessed by the game, by our era.</strong></p>
<p>This was one of the most happy times in my life. I wrote code for frontend, using jquery, making synergy with artist members. They created photoshop file and deliver to me. And I created webpages according to that.</p>
<p><img decoding="async" loading="lazy" alt="myworkfolder" src="https://jabberwocky238.github.io/assets/images/myworkfolder-b2fa3c3f4ea60ef73e7764150f6dd30e.png" width="1092" height="641" class="img_ev3q"></p>
<p>Although I was not a good frontend programmer then, I still build everything up and be proud of that.</p>
<p>For all my readers, you still have access to the websides, both <a href="https://wiki.biligame.com/shinycolors/%E9%A6%96%E9%A1%B5" target="_blank" rel="noopener noreferrer">Enza</a> and <a href="https://wiki.biligame.com/imasscsfp/%E9%A6%96%E9%A1%B5" target="_blank" rel="noopener noreferrer">Song for Prism</a></p>
<p>When it comes to my favorate part, I must take out <a href="https://wiki.biligame.com/shinycolors/%E5%89%A7%E6%83%85%E6%95%B4%E7%90%86%E9%A1%B5" target="_blank" rel="noopener noreferrer"><strong>table of all stories</strong></a>. I wrote each line of code. It was created in a hasty way, full of trash code, but it has functioned well up to now.</p>
<p>The memory of that period is as clear as it happened yesterday. I am sured I will cherish it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-golden-age-dont-last-long">The golden age don't last long<a href="https://jabberwocky238.github.io/blog/2024/10/06/ShinyColor-1#the-golden-age-dont-last-long" class="hash-link" aria-label="The golden age don't last long的直接链接" title="The golden age don't last long的直接链接">​</a></h2>
<p>Due to some inevitable reasons, our team disbanded.</p>
<p>The main cause is the leader of us had been criticized by the outside-world community, aka <strong>Chinese residing abroad</strong>.</p>
<blockquote>
<p>"You are making ShinyColor family filled with kids and basterds."</p>
</blockquote>
<blockquote>
<p>"You've broken the peace in our little community."</p>
</blockquote>
<blockquote>
<p>"A real fan won't do such thing like what you do."</p>
</blockquote>
<p>The leader took it all, just told us they were jealous of us.</p>
<p>But after all, he still wanted to fit in the community. He had been there for 8 years, since he was graduated from college.</p>
<p><strong>It is his youth.</strong></p>
<p>And he decided to quit, finally. He relinquished his authority of website edition to another big brother in our team.</p>
<p>Disappeared.</p>
<p>Along with my golden age.</p>
<p><img decoding="async" loading="lazy" alt="noctchill" src="https://jabberwocky238.github.io/assets/images/youths-ad0a66ff0c76d1f95c9c8fb4ae2a6606.jpg" width="1136" height="640" class="img_ev3q"></p>
<p><em>Community lasts, I fade away.</em></p>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
        <category label="en" term="en"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Build tree from table in Rust]]></title>
        <id>https://jabberwocky238.github.io/blog/2024/10/03/Build-tree-from-table-in-Rust</id>
        <link href="https://jabberwocky238.github.io/blog/2024/10/03/Build-tree-from-table-in-Rust"/>
        <updated>2024-10-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Build tree data structrue from table, in Rust.]]></summary>
        <content type="html"><![CDATA[<p>This <code>{ truncate }</code> is so fucking ugly...</p>
<p>{/* truncate */}</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a href="https://jabberwocky238.github.io/blog/2024/10/03/Build-tree-from-table-in-Rust#motivation" class="hash-link" aria-label="Motivation的直接链接" title="Motivation的直接链接">​</a></h2>
<p>I have a project named <a href="https://github.com/jabberwocky238/Jobs" target="_blank" rel="noopener noreferrer">Jobs</a>.</p>
<p>The duty of this app, maybe is scanning and calculating disk and folders' size. In this process, store the node of files and directories. Therefore we can reuse the nodes to speed up next round of scanning.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="persistent-storage">Persistent storage<a href="https://jabberwocky238.github.io/blog/2024/10/03/Build-tree-from-table-in-Rust#persistent-storage" class="hash-link" aria-label="Persistent storage的直接链接" title="Persistent storage的直接链接">​</a></h2>
<p>Obviously, I need to find a good way to persist my data to disk.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-i-dont-use-json">Why I dont use JSON<a href="https://jabberwocky238.github.io/blog/2024/10/03/Build-tree-from-table-in-Rust#why-i-dont-use-json" class="hash-link" aria-label="Why I dont use JSON的直接链接" title="Why I dont use JSON的直接链接">​</a></h3>
<p>At first, I choose JSON, because of its straightforward tree structure. But then I found out that I could be tied up by it.</p>
<p>When I want to save a subdirectory, I have to start from the root and traverse the tree, deep down below until I find the target. This is not efficient and robust.</p>
<p>What's more, I will add an additional feature to this app in the future. The most possible one is <strong>trie search</strong>, which cannot create a good synergy with JSON. Because the insert and delete of trie is not as easy as you think.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="csv">CSV<a href="https://jabberwocky238.github.io/blog/2024/10/03/Build-tree-from-table-in-Rust#csv" class="hash-link" aria-label="CSV的直接链接" title="CSV的直接链接">​</a></h3>
<p>Before I fall on CSV, I have tried Graph Database, which can maintain the tree structure of my idea before.</p>
<p>But then I found out the complexity is definitely too high for me to have a good control of the whole project.</p>
<p>Then I turn around to try sqlite, but there is such a apparent thing to wake me up:</p>
<p><em>Sqlite is a relational database. So why don't I just use a csv file instead?</em></p>
<p>So I choose CSV afterward.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="come-to-the-point">Come to the point<a href="https://jabberwocky238.github.io/blog/2024/10/03/Build-tree-from-table-in-Rust#come-to-the-point" class="hash-link" aria-label="Come to the point的直接链接" title="Come to the point的直接链接">​</a></h2>
<p>Relational database has a table structure. So the problem here has turning into <strong>"How to turn a table to a tree and vice versa"</strong>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="serialize">serialize<a href="https://jabberwocky238.github.io/blog/2024/10/03/Build-tree-from-table-in-Rust#serialize" class="hash-link" aria-label="serialize的直接链接" title="serialize的直接链接">​</a></h3>
<p>First, let talk about serialize, aka turning a tree to a table.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">child_hash, parent_hash, details...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And everything else is the same as sql<code>JOIN</code>.</p>
<p>Easy, hah?</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deserialize">deserialize<a href="https://jabberwocky238.github.io/blog/2024/10/03/Build-tree-from-table-in-Rust#deserialize" class="hash-link" aria-label="deserialize的直接链接" title="deserialize的直接链接">​</a></h3>
<p>Now let's talk about deserialize, aka turning a table to a tree.</p>
<p>The first idea coming into my mind is build tree in a top-down way. Create the root node first, then its children.</p>
<p>What follows is the very strengent regulation of Rust's mutation and ownership. If the root create at first, then it must be mutable. Because we need to add children to it. But for the subtree, which can be called "subroot", they also need to be mutable. But the implementation confronts the double use of the same mutable reference.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">deserialize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">DirInfo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">dyn</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> row </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> subroot</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">DirInfo</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> row</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">into</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> parent </span><span class="token operator">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">find_parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">subroot</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)">// illegal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// parent need to be change, but it still in data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// data itself is borrowed by for loop.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// so we can't take mutable parent out of it.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">insert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">subroot</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>OK, after that, I have tried many different ways, such as maintaining an additional symbol table, hashmap, clone, vector, drain / reduce / rev, etc...</p>
<p>None of them can solve this elegantly.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>evil reduce function😲😲😲😲😲</summary><div><div class="collapsibleContent_i85q">
  <!-- -->
<p>Here is a interesting issue that I want to talk about:</p>
<p>Rust's iterator have a function called <code>reduce</code>, which literally means reduce the whole vector into a single element. And this is exactly what I want.</p>
<p>My assumption is like:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> root </span><span class="token operator">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">reduce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">array</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token closure-params"> element</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">find_parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">element</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">insert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">element</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    array</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Is that extremely nice? How smart I am!</p>
<p>Fuck!</p>
<p><code>reduce</code> have two paramters, the first one is element, the second one is also the fucking element!</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> root </span><span class="token operator">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">reduce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">a</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token closure-params"> b</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    a </span><span class="token operator">+</span><span class="token plain"> b </span><span class="token comment" style="color:rgb(98, 114, 164)">// how stupid it is!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is different with javascript!</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> root </span><span class="token operator">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">reduce</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token parameter">prev</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> cur</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> index</span><span class="token parameter punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token parameter"> arr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">find_parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">element</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">insert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">element</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> array</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</div></div></details>
<p>After all, I came out a solution, which is a bottom-up way. Create the leaf node first, then its parent.</p>
<p><code>DumpData</code> is csv format, <code>Node</code> is tree format.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> data </span><span class="token operator">=</span><span class="token plain"> rdr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">deserialize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">DumpData</span><span class="token operator">&gt;&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> dumpdata </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// make sure child node exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// it will return '$mut Node', but we don't want the ref, but the pure value.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">entry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">or_insert_with</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">to_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// take child out</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> child_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">remove</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this way, we can make sure the child node is completely owned by loop. And it can be removed after adding into parent.</p>
<p>What about the parent node? We can't remove it from the data, because it is still in the loop. So we need to find it in the <code>data</code> again.</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> dumpdata </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// make sure parent node exists, and unique</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> parent_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$mut</span><span class="token plain"> </span><span class="token class-name">Node</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">entry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">phash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">or_insert_with</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">find</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">d</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash </span><span class="token operator">==</span><span class="token plain"> dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">phash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">to_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">children</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">insert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> child_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And the parent Node still stays in the <code>data</code>, so it can be used in the next loop.</p>
<p>full code below:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">deserialize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">DirInfo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">dyn</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// 获取用户的 HOME 目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> home_dir </span><span class="token operator">=</span><span class="token plain"> </span><span class="token namespace">env</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">var</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"HOME"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">or_else</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">_</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token namespace">env</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">var</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"USERPROFILE"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">?</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// 创建 CSV 文件的完整路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> file_path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token macro property">format!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"{}/example.csv"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> home_dir</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// 读取文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> file </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">File</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">file_path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">?</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> rdr </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Reader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">from_reader</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">u64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">JNode</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">HashMap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">JNode</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">None</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> data </span><span class="token operator">=</span><span class="token plain"> rdr</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">deserialize</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">result</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">DumpData</span><span class="token operator">&gt;&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">into_iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">rev</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">DumpData</span><span class="token operator">&gt;&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> dumpdata </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        symbols</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">entry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">or_insert_with</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">to_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> child_node </span><span class="token operator">=</span><span class="token plain"> symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">remove</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">phash </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            root </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">child_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">continue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> parent_node </span><span class="token operator">=</span><span class="token plain"> symbols</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">entry</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">phash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">or_insert_with</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">find</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">d</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash </span><span class="token operator">==</span><span class="token plain"> dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">phash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">unwrap</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">to_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token class-name">JNode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">DirInfo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> parent_node </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            parent</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">children</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">insert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dumpdata</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">chash</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> child_node</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">match</span><span class="token plain"> root </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token class-name">Some</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">JNode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">DirInfo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        _ </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token class-name">Err</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Fail to deserialize"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">into</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Ah...The second blog...</em></p>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
        <category label="en" term="en"/>
        <category label="tech" term="tech"/>
        <category label="rust" term="rust"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[坚持不懈]]></title>
        <id>https://jabberwocky238.github.io/blog/2024/09/30/Patience-and-Persistence</id>
        <link href="https://jabberwocky238.github.io/blog/2024/09/30/Patience-and-Persistence"/>
        <updated>2024-09-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[EN Title: Patience and Persistence]]></summary>
        <content type="html"><![CDATA[<p>EN Title: Patience and Persistence</p>
<blockquote>
<p>必须要写一些东西吧</p>
</blockquote>
<p>{/* truncate */}</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="有一些话以前听的">有一些话，以前听的<a href="https://jabberwocky238.github.io/blog/2024/09/30/Patience-and-Persistence#%E6%9C%89%E4%B8%80%E4%BA%9B%E8%AF%9D%E4%BB%A5%E5%89%8D%E5%90%AC%E7%9A%84" class="hash-link" aria-label="有一些话，以前听的的直接链接" title="有一些话，以前听的的直接链接">​</a></h2>
<p>应该是在看哪本技术书籍时候，译者的言论里，有写他的翻译历程。一开始他啥都不想写，坚持不下去，在妻子的“压迫”下每天坚持写五页，过了一年，成功翻译出一本巨著。</p>
<p>这让我想到的是，似乎我本科期间一直没有坚持做某一件事。一开始喜欢HTML+CSS+JS，搞了半天前端，后面做大作业确实承担起无数前端开发责任。然后是机器学习，python，深度学习，AI，我似乎都没什么兴趣。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="项目驱动型">项目驱动型<a href="https://jabberwocky238.github.io/blog/2024/09/30/Patience-and-Persistence#%E9%A1%B9%E7%9B%AE%E9%A9%B1%E5%8A%A8%E5%9E%8B" class="hash-link" aria-label="项目驱动型的直接链接" title="项目驱动型的直接链接">​</a></h2>
<p>实际上是因为我是“项目驱动型”的人，你交给我一个任务，我会尽一切可能完成它。一开始我想做网站，搭了静态页面，那是2021年暑假？（大一下学期，我还没有收到转专业成功的信息，但已经迫不及待地开始写代码了）后面又搞很多，python脚本，服务器，MC，linux。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="我做过的">我做过的<a href="https://jabberwocky238.github.io/blog/2024/09/30/Patience-and-Persistence#%E6%88%91%E5%81%9A%E8%BF%87%E7%9A%84" class="hash-link" aria-label="我做过的的直接链接" title="我做过的的直接链接">​</a></h2>
<p>好多东西，我甚至都没push到github之类的托管平台，随着我的兴趣涨落，慢慢的都消失了，甚至在电脑磁盘上都找不到它们了。</p>
<ul>
<li>python env GUI (start at 2024/3, stop at 2024/6)</li>
</ul>
<p>这是一个我一直想做的项目，就是给python包管理做一个真正好用的GUI，这样对新手入门会非常有利。现在我还在“龟速坚持”这个项目，只不过还没有想好选什么GUI框架，大概率是python的GUI，以便做到“原汤化原食”和“足够简单，足够快速”。以前在用tauri，做了相当一部分，因为懂前端和rust，后面遇到了环境变量无法控制的情况（tauri限制还是太多了），当时觉得必须要一个很给力的powershell脚本，但也因此搁置了很久。</p>
<ul>
<li>filesystem manager (start at 2024/8, not stop yet)</li>
</ul>
<p>最近在搞的一个c++项目，以后也肯定会套上GUI的，要不然对普通用户而言用不了。但目前只是core建设还没完成的阶段，所以还有很远的路。主要动机其实是训练自己的C++水平，c++17标准，cmake，etc...还是挺恶心的。主要想实现类似《treesize》《everything》《listary》的功能，查找还不在todo list上，目前只是记文件夹大小。</p>
<p>天哪，我不得不翻一下我的文件夹和repo，因为我都忘了我做过什么...</p>
<p>好多废品，比如：</p>
<ul>
<li>JS/TS stuffs
<ul>
<li>boids鸟群算法，使用PIXI.js做动画库，最后也没做出来，因为是一天做完+瞎搞，也不知道具体算法怎么回事。</li>
<li>TJU OJ，前端傻逼项目，threejs旋转球，and so on。</li>
<li>全栈项目，登录+评论+视频转码+权限。nginx，docker，cicd。</li>
<li>一万个大作业，vue3|vue2|astro|react，呃呃。</li>
</ul>
</li>
</ul>
<p>🐎的，我做的好少啊，细数一下也就这点。</p>
<ul>
<li>micromark extension</li>
</ul>
<p>这个算是比较有用，micromark项目扩展，解析obsidian的link，这也是我为什么决定学编译路线的原因？（为了这盘醋包的饺子）</p>
<ul>
<li>rust-jlox</li>
</ul>
<p>《crafting interpreters》的jlox的rust实现，但是因为我不会编译，这项目架构乱得很，所以决定先学编译原理了。</p>
<p>还有一些学校做的事情，我觉得不算我的项目，毕竟那玩意你说，我真掌握了多少呢？估计有没有十分之一，MLIR-LLVM，好可怕。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="坚持一些东西">坚持一些东西<a href="https://jabberwocky238.github.io/blog/2024/09/30/Patience-and-Persistence#%E5%9D%9A%E6%8C%81%E4%B8%80%E4%BA%9B%E4%B8%9C%E8%A5%BF" class="hash-link" aria-label="坚持一些东西的直接链接" title="坚持一些东西的直接链接">​</a></h2>
<p>我不知道我的托福什么时候可以100+，现在已经95了（27，21，22，25），我觉得下次可以100，但也不一定。</p>
<p>所以我接下来要坚持一些事情，比如写博客，也不一定是技术博客，如果是技术博客我应该会打上标签吧。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="襁褓中的">襁褓中的<a href="https://jabberwocky238.github.io/blog/2024/09/30/Patience-and-Persistence#%E8%A5%81%E8%A4%93%E4%B8%AD%E7%9A%84" class="hash-link" aria-label="襁褓中的的直接链接" title="襁褓中的的直接链接">​</a></h2>
<p>我一直想做一个高技术力的东西，比如rust wasm md compiler，有屁用吗？哈哈。</p>
<p>但是从小做起，我认为我的讲课能力还是可以的，一般没人在我讲完之后感觉没懂，都是很自信的离开，结果都很好。所以我的起步可能是做教学？我暂且打算教python，但是鉴于竞品太多了，所以我的direction可能会更细分一些，比如“给我奶奶讲明白python”这种，不过即使是这种程度估计也有很多竞品，毕竟“让别人理解”很简单，但是让人“产生兴趣”就难了，而我有这个信心。</p>
<p>所以应该是python教程起步吧，我会在b站发视频吧应该，期待一下未来的我的决定。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="in-the-long-term">In the long term<a href="https://jabberwocky238.github.io/blog/2024/09/30/Patience-and-Persistence#in-the-long-term" class="hash-link" aria-label="In the long term的直接链接" title="In the long term的直接链接">​</a></h2>
<p>长远来看我是想做硬件的，第一是壁垒很高，第二是硬件才是真正的产品，所以我可能努力在硕士期间搞一搞EE，以求从全栈程序员进化到全栈工程师。</p>
<p>银翼杀手是我的妄想，也是我的梦想。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="last-but-not-least">last but not least<a href="https://jabberwocky238.github.io/blog/2024/09/30/Patience-and-Persistence#last-but-not-least" class="hash-link" aria-label="last but not least的直接链接" title="last but not least的直接链接">​</a></h2>
<p>我觉得博客写点啥都无所谓吧，当日记可能不太好，所以我不太可能记录家里面发生的事，但是记录一下自己的思想应该不错。</p>
<p>所以我决定以一段鸡汤结尾：</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>You either better roll with me, or you gonna be rolled over.</div><div class="admonitionContent_BuS1"><p>If you stay in an environment where people dont recognize the value of you, you will shrink, you will give to the size of what they can stand.</p><p>And that's what causes anxiety, and depression, and stress.</p><p>Because you have to shrink.</p><p>I refuce to be small because you think small.</p><p>I am not shrinking to your vision because you can't catch up.</p><p><strong>You either better roll with me, or you gonna be rolled over.</strong></p></div></div>
<p><a href="https://www.bilibili.com/video/BV1MMpgeZEiq" target="_blank" rel="noopener noreferrer"><em>where it comes from</em></a></p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Toggle me!</summary><div><div class="collapsibleContent_i85q">
  <!-- -->
<p>This is the detailed content</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token console class-name">console</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token method function property-access" style="color:rgb(80, 250, 123)">log</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Markdown features including the code block are available"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can use Markdown here including <strong>bold</strong> and <em>italic</em> text, and <a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer">inline link</a></p>
  <details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Nested toggle! Some surprise inside...</summary><div><div class="collapsibleContent_i85q">
    <!-- -->
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">😲😲😲😲😲</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
  </div></div></details>
</div></div></details>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
        <category label="zh" term="zh"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[入学天津大学，没有人会告诉你的秘密]]></title>
        <id>https://jabberwocky238.github.io/blog/2024/08/26/what-people-will-not-tell-you-when-entering-TJU</id>
        <link href="https://jabberwocky238.github.io/blog/2024/08/26/what-people-will-not-tell-you-when-entering-TJU"/>
        <updated>2024-08-26T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[入学天津大学，没有人会告诉你的秘密]]></summary>
        <content type="html"><![CDATA[<p>Backup for <a href="https://zhuanlan.zhihu.com/p/716619038" target="_blank" rel="noopener noreferrer">zhihu</a></p>
<p>本人已经大四了，马上就要离开校园了，但回忆往昔还是有很多意不平，尤其是严重的信息不对称，导致了我很多没能更好的发挥和得到更好的结果，特此写一篇文章送给学弟学妹们。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一学习篇">一，学习篇<a href="https://jabberwocky238.github.io/blog/2024/08/26/what-people-will-not-tell-you-when-entering-TJU#%E4%B8%80%E5%AD%A6%E4%B9%A0%E7%AF%87" class="hash-link" aria-label="一，学习篇的直接链接" title="一，学习篇的直接链接">​</a></h2>
<p>1，除了图书馆，45和46教，任何一栋教学楼都是全天开放，并且没人管你，可以随时进出，相当于无人打扰的自习室，要比图书馆更安静。</p>
<p>因为我是建工转智算，所以我常去44机械楼，47智算楼和33自习。其他专业的楼大部分也可以随便进，比如32理学院。</p>
<p>2，如果你打算保研和出国，大二必须开始准备，因为通货膨胀已经到这个程度了，不要享受青春，因为你选择了竞争，你的青春注定孤独，这不是你的错，错的是这个世界。</p>
<p>3，计划外选课可以直接修未来的课程，你可以提前上完课，虽然tju没有提前毕业的设定，但对于某些同学而言，这个操作仍然很有用。</p>
<p>此外，由于计划外选课可以被任何人选，所以你可以不上应修课程，留到以后再上，但是如果毕业前没有修完你会延毕，此操作有风险。</p>
<p>举例，有一个大哥为了转专业去学计算机，把原专业课全退了，选了计算机的课，学了整整一学期计算机，背水一战，最终转专业考试通过了，他不仅不需要和其他同学一起补修计算机课程(因为他修完了)，而且他没有上废课(原专业的课在转专业后自动成为计划外，但仍然会影响你的GPA)。</p>
<p>*此案例不应该成为你的选择，玩火会自焚。</p>
<p>4，大一时建议学好英语，六级570+可以免修所有英语课，越早达到此分数越好，尤其对于出国的同学，会节省很多时间和GPA。</p>
<p>5，大一大二建议努力锻炼正确体测75+，可以免修下一个学期的体育，这可以节省很多时间和GPA。</p>
<p>6，(*此条有争议，对于高数线代等课必须听讲，否则不可能有好成绩）期末突击仍然是最好的备考方式，因人而异，但你应该明白，tju的本科教学能力并不能让你拥有碾压peer的竞争优势。</p>
<p>7，关于本科就业，如果你希望本科毕业后得到很好的工作和薪水，建议面向就业学习，更多的实习经历会让你更有职场竞争力，而不是花时间卷GPA，不要担心分太低，也不要担心大一就实习是否太过分，这是现状，这是生存。</p>
<p>仍然要嘱咐一句，错的不是你，是这个世界，不过，你已经考到985了，相信你接下来也可以继续当人上人，所以不要放弃。</p>
<p>8，如果你打算读研，你应该牺牲一切以换取更高的GPA，虽然你会认为这很草菅人命，但当你大三结束时（保研名额结算），你会看到周围人焦虑的不可开交（试图通过比赛获取0.5保研加分/试图准备考研），而你此时可以获得大四一整年的假期。</p>
<p>9，关注实验室学长学姐抛出的橄榄枝，看上去像你给他免费打工，但实际上是宝贵的经验，你不会后悔的，哪怕你遇到了脑摊教授和脑摊学长，也是一种长见识，并且最重要的是，你是本科生，你的退出不需要任何理由。</p>
<p>但也因此，你要展现出极高的热情和学习潜力，花费很长时间做很多事，才能赢得学长和教授的信任，从而给你更有价值的任务，以至于获得留在组里的机会，也就是俗称的内定保研（如果你的成绩大概率可以保研，你要记得去签"师生互选同意书"，防止意外发生）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二竞赛篇">二，竞赛篇<a href="https://jabberwocky238.github.io/blog/2024/08/26/what-people-will-not-tell-you-when-entering-TJU#%E4%BA%8C%E7%AB%9E%E8%B5%9B%E7%AF%87" class="hash-link" aria-label="二，竞赛篇的直接链接" title="二，竞赛篇的直接链接">​</a></h2>
<p>0，你值得且应该把精力放在其他地方。</p>
<p>1，竞赛只对保研有用，对找工作一点用也没有，除非对口的比赛，如acm/天池杯/kaggle，此外，例如数学建模这种比赛，HR完全不在乎，即使你拿了国奖。</p>
<p>2，不要为了任何比赛牺牲GPA，后者比前者重要一万倍，哪怕已经打进了国赛，国赛输了最后只剩一纸奖状和几百块钱的情况太多了。</p>
<p>除非有老板愿意直招你去他们公司，并且给出了不错的薪水，并且该公司风评不差，否则一律算大病，年轻人就喜欢吃大饼。</p>
<p>3，不要只关注tju宣传的比赛，多关注其他985在打什么，含金量更高的比赛有很多，别老盯着数学建模和互联网+，你如果是普通市民，这种比赛对你屁用没有。</p>
<p>4，关于数学建模比赛，你选修的3学分的《数学模型》课程对你的能力提高没有任何帮助，不过这个课很适合入门"论文写作"。</p>
<p>并且此课给分一般较好，你不需要花很多精力听讲，只需要每天签到，如果你认真完成了结课论文，即使你的模型像屎，也会获得95+的分数。</p>
<p>举例，我打了7次比赛，包括2次国赛校选，2次美赛校选，1次美赛，1次国赛，1次深圳杯，最终只获得了国赛省级一等奖，你可以说我菜，但我凭良心说，没有借助任何学长学姐的帮助，独自学习试错打出来此成绩，故作为参考分享给你，难度很高，收益很低。</p>
<p>5，竞赛的好处是，给了你一个实践的机会，而不只是停留在理论层面，这对理工科的同学是很重要的，例如机械/ee/cs的比赛往往都很有实践价值，例如大名鼎鼎的电赛，机器人和软件杯。</p>
<p>但是"以赛促学"的命题是假的，因为你并不需要一个比赛来促进你去学，如果你像我一样天生对自己专业感兴趣，那么你应该已经在自发的用自己的休息时间完成一些小项目了。</p>
<p>包括但不限于玩单片机，制作网站，制作软件，甚至是合成危险化学品。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三鸡汤篇">三，鸡汤篇<a href="https://jabberwocky238.github.io/blog/2024/08/26/what-people-will-not-tell-you-when-entering-TJU#%E4%B8%89%E9%B8%A1%E6%B1%A4%E7%AF%87" class="hash-link" aria-label="三，鸡汤篇的直接链接" title="三，鸡汤篇的直接链接">​</a></h2>
<p>0，不要自卑，不要乱想，不要放弃</p>
<p>1，事业永远比爱情更重要，但在大学，这件事并不一定成立。</p>
<p>毕竟如果你不能在大学谈一场轰轰烈烈的恋爱，到了社会上无法慧眼识人，甚至被骗，这可不是什么好事。</p>
<p>2，黑暗森林的成立条件是没有建立关系的情况，所以勇敢的做一个e人，勇敢的跟任何人打招呼，大学里，什么事都能发生。</p>
<p>3，混乱无处不在，保护好自己</p>
<p>4，这个大学虽然并不出众，但它足够把你送到任何你想去的地方，在这里，努力可以登天。</p>
<p>5，成功更多缘于机遇而不是能力。</p>
<p>如果你不信，迟早你会信的。</p>
<p>但，也因此，你会明白能力的价值——</p>
<p>接住机遇——机会只会留给有准备的人。</p>
<p>"尽人事，听天命。"</p>
<p>6，多刷刷手机，这样你在大学毕业前就能感觉到一切都在重复上演，大部分人都活在一个怪圈里。</p>
<p>7，看哲学视频并不会让你更聪明，读哲学书也是，它的作用诞生于你投身实践的那一刻，终结于你得知未知事物的一瞬间。</p>
<p>8，有钱也得干自己不想干的活儿这种情况太过于正常了，有钱人也不一定就拥有说放弃就放弃的权利，很多做生意的已经非常有钱了，还是每天坚持去干，真是没办法或者就是不断坚持。</p>
<p>很多事不长期坚持或者主动吃屎是很难挣到钱的，至少普通人挣100万就比连吃一个月屎要难。</p>
<p>9，至少，无论如何，我们都只有一条命。</p>
<p>10，我们确实身处于大变局的时代，因为你活着的每一秒都应该是大变局。</p>
<p>11，(说给男生听)</p>
<p>你的爱意不属于你的心，而是属于睾丸和大脑受体，这件事一辈子都不会变。</p>
<p>但你的责任感，能力，性格，以及自知之明和奋斗的热血，永远是你的魅力所在。</p>
<p>不幸的是，你爱的她，一般不会真心爱你，幸运的是，你会因此明白，爱你的她，会是真的爱你。</p>
<p>如果你见到了属于你的灰姑娘，你才会明白，这里没有爱情，只有责任和负担。</p>
<p>To be or not to be.</p>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
        <category label="zh" term="zh"/>
        <category label="golden" term="golden"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[MDX Blog Post]]></title>
        <id>https://jabberwocky238.github.io/blog/mdx-blog-post</id>
        <link href="https://jabberwocky238.github.io/blog/mdx-blog-post"/>
        <updated>2021-08-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Blog posts support Docusaurus Markdown features, such as MDX.]]></summary>
        <content type="html"><![CDATA[<p>Blog posts support <a href="https://docusaurus.io/docs/markdown-features" target="_blank" rel="noopener noreferrer">Docusaurus Markdown features</a>, such as <a href="https://mdxjs.com/" target="_blank" rel="noopener noreferrer">MDX</a>.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>Use the power of React to create interactive blog posts.</p></div></div>
<p>{/* truncate */}</p>
<p>For example, use JSX to create an interactive button:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token operator">&lt;</span><span class="token plain">button onClick</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">alert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">'button clicked!'</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token operator">&gt;</span><span class="token maybe-class-name">Click</span><span class="token plain"> me</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">button</span><span class="token operator">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>&lt;button onClick={() =&gt; alert('button clicked!')}&gt;Click me!</p>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Long Blog Post]]></title>
        <id>https://jabberwocky238.github.io/blog/long-blog-post</id>
        <link href="https://jabberwocky238.github.io/blog/long-blog-post"/>
        <updated>2019-05-29T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[This is the summary of a very long blog post,]]></summary>
        <content type="html"><![CDATA[<p>This is the summary of a very long blog post,</p>
<p>Use a <code>&lt;!--</code> <code>truncate</code> <code>--&gt;</code> comment to limit blog post size in the list view.</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[First Blog Post]]></title>
        <id>https://jabberwocky238.github.io/blog/first-blog-post</id>
        <link href="https://jabberwocky238.github.io/blog/first-blog-post"/>
        <updated>2019-05-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Lorem ipsum dolor sit amet...]]></summary>
        <content type="html"><![CDATA[<p>Lorem ipsum dolor sit amet...</p>
<p>...consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet</p>]]></content>
        <author>
            <name>jabberwocky238</name>
            <uri>https://github.com/jabberwocky238</uri>
        </author>
    </entry>
</feed>