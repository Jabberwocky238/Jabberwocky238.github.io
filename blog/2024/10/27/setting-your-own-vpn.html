<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">自建VPN+DNS实现内网穿透和组网 | JW238 Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://jabberwocky238.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://jabberwocky238.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="自建VPN+DNS实现内网穿透和组网 | JW238 Site"><meta data-rh="true" name="description" content="MDX版本文章更好看，转载于知乎"><meta data-rh="true" property="og:description" content="MDX版本文章更好看，转载于知乎"><meta data-rh="true" name="keywords" content="VPN,DNS,WireGuard,OpenVPN,bind9,named,frp,内网穿透,内网互联,域名,端口转发,组网"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-10-27T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/jabberwocky238"><meta data-rh="true" property="article:tag" content="zh,tech,golden"><link data-rh="true" rel="icon" href="/img/cometik.webp"><link data-rh="true" rel="canonical" href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn"><link data-rh="true" rel="alternate" href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn","mainEntityOfPage":"https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn","url":"https://jabberwocky238.github.io/blog/2024/10/27/setting-your-own-vpn","headline":"自建VPN+DNS实现内网穿透和组网","name":"自建VPN+DNS实现内网穿透和组网","description":"MDX版本文章更好看，转载于知乎","datePublished":"2024-10-27T00:00:00.000Z","dateModified":"2024-11-04T02:40:00.000Z","author":{"@type":"Person","name":"jabberwocky238","description":"WTF","url":"https://github.com/jabberwocky238","image":"/jw238_avatar.png"},"keywords":["VPN","DNS","WireGuard","OpenVPN","bind9","named","frp","内网穿透","内网互联","域名","端口转发","组网"],"isPartOf":{"@type":"Blog","@id":"https://jabberwocky238.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="JW238 Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="JW238 Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.be0200d2.css">
<script src="/assets/js/runtime~main.537794a6.js" defer="defer"></script>
<script src="/assets/js/main.d5f57d9c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/cometik.webp" alt="JW238 Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/cometik.webp" alt="JW238 Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">JW238</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blogs</a><a class="navbar__item navbar__link" href="/English">English</a><a class="navbar__item navbar__link" href="/MCU">MCU</a><a class="navbar__item navbar__link" href="/Rust">Rust</a><a class="navbar__item navbar__link" href="/LTS">LTS</a></div><div class="navbar__items navbar__items--right"><a href="https://space.bilibili.com/86221452" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Bilibili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/jabberwocky238/jabberwocky238.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS darkNavbarColorModeToggle_X3D1" type="button" disabled="" title="切换浅色/暗黑模式（当前为暗黑模式）" aria-label="切换浅色/暗黑模式（当前为暗黑模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">All our posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/11/04/docusaurus-usage">docusaurus正常打开方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/11/02/zhihu-markdown-best-practice">markdown上传知乎最佳实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/11/01/trojan-gfw">trojan使用记录</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2024/10/27/setting-your-own-vpn">自建VPN+DNS实现内网穿透和组网</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/10/07/Recursive-and-Loop-rust">rust中变换递归为循环的必要性</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/10/06/ShinyColor-1">Animate girls, ShinyColors.</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/10/03/Build-tree-from-table-in-Rust">Build tree from table in Rust</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/09/30/Patience-and-Persistence">坚持不懈</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2024/08/26/what-people-will-not-tell-you-when-entering-TJU">入学天津大学，没有人会告诉你的秘密</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mdx-blog-post">MDX Blog Post</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2019</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/long-blog-post">Long Blog Post</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/first-blog-post">First Blog Post</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">自建VPN+DNS实现内网穿透和组网</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-10-27T00:00:00.000Z">2024年10月27日</time> · <!-- -->阅读需 25 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/jabberwocky238" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="/jw238_avatar.png" alt="jabberwocky238"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/jabberwocky238" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">jabberwocky238</span></a></div><small class="authorTitle_nd0D" title="WTF">WTF</small><div class="authorSocials_rSDt"><a href="https://github.com/jabberwocky238" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg viewBox="0 0 256 250" width="1em" height="1em" class="authorSocialLink_owbf githubSvg_Uu4N" xmlns="http://www.w3.org/2000/svg" style="--dark:#000;--light:#fff" preserveAspectRatio="xMidYMid"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><a href="https://jw238.site/blog/2024/10/27/setting-your-own-vpn" target="_blank" rel="noopener noreferrer">MDX版本文章</a>更好看，转载于<a href="https://zhuanlan.zhihu.com/p/3446441267" target="_blank" rel="noopener noreferrer">知乎</a></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>如果你只想要内网穿透，直接看 <strong><a href="/blog/2024/10/27/setting-your-own-vpn#%E4%B8%80%E5%89%8D%E6%83%85%E6%8F%90%E8%A6%81">前情提要</a></strong> 里的 <strong><a href="https://github.com/fatedier/frp" target="_blank" rel="noopener noreferrer">Frp</a>内网穿透</strong> 部分即可，如果你想要组网，可以只看 <strong><a href="/blog/2024/10/27/setting-your-own-vpn#%E4%B8%89wireguard">WireGuard</a></strong> 部分。</p></div></div>
<p>本篇文章涉及了自组网，VPN，内网穿透，内网设备互联，自定义域名解析，端口转发等内容。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一前情提要">一，前情提要<a href="#一前情提要" class="hash-link" aria-label="一，前情提要的直接链接" title="一，前情提要的直接链接">​</a></h2>
<p>上次我听说VPN还是在做违法的事情的时候, 实际上VPN全称为“Virtual Private Network”, 是一种通过公共网络建立私密网络的技术。虽然这个词被大家乱用为翻过GFW的工具, 但细数现在流行的工具, 比如clash, v2ray, trojan, 他们的侧重点都在伪装。而纯血VPN只需要考虑加密, 这也是我这篇文章主要讨论的内容。</p>
<p>我自建VPN的初衷并不是翻GFW, 而是我自己搞了一个迷你主机, 类似nas, 但是侧重计算。我有两台云服务器, 以前玩MC剩下的, 但是很显然, 这两台云服务器垂垂老矣, 满足不了我的需求, 而且太贵了。<strong>腾讯云, 你在吃人肉</strong>(二改：腾讯云真便宜，阿里你在吃人肉)。</p>
<p>所以我借助两台云服务器自带的公网IP, 就想先做个frp内网穿透。当然, <a href="https://github.com/fatedier/frp" target="_blank" rel="noopener noreferrer">frp</a>是非常简单的, 小学生水平, 你看两眼就能自己配出来。</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">frps.toml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">bindPort = 7000</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">frpc.toml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">serverAddr = &quot;x.x.x.x&quot;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">serverPort = 7000</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[[proxies]]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">name = &quot;mcs&quot;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">type = &quot;tcp&quot;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">localIP = &quot;127.0.0.1&quot;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">localPort = 23333</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">remotePort = 23333</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这样两个文件直接就能把内网的mcsmanager管理平台透出来, 公网开个23333端口就行了。类似的操作, 暴露游戏25565端口也是易如反掌的, 透udp也只是改几个字的事。</p>
<p>但显然, 这样做会导致<strong>很严重的安全问题</strong>, 你管理平台是暴露在公网的, 别人随便点进来就能用, 很容易被搞。另外, 这是游戏服务器, 自己玩也就还好, 如果是企业级的需求呢？家庭需求呢？私密度更高的数据呢？于是我想到了我的校园网。</p>
<p>天津大学的校园网可以用easy connect连进VPN, 然后访问内网设施。我想的就是类似操作, 自己建一个VPN, 连进来才能访问mcs管理界面和其他东西。于是我开始沿着这一条路走到黑了。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二openvpn">二，OpenVPN<a href="#二openvpn" class="hash-link" aria-label="二，OpenVPN的直接链接" title="二，OpenVPN的直接链接">​</a></h2>
<p>首先想到的是IPsec和PPTP, 因为这是AI告诉我的技术, 但是经过一番查找, 我发现那玩意已经过时了, 似乎也找不到一键启动的脚本, 于是我继续找, 找到了大名鼎鼎的<a href="https://github.com/OpenVPN/openvpn" target="_blank" rel="noopener noreferrer">OpenVPN</a>。</p>
<p>这个玩意是典型的C/S架构, 理解起来不难, 就是配置比较有旧时代风格, 可以看到这玩意是C语言写的, 配置也是足够的GNU style（<strong>纯脚本咔咔干啊...</strong>）</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>接下来所有操作系统都基于ubuntu20.04</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-init">1. init<a href="#1-init" class="hash-link" aria-label="1. init的直接链接" title="1. init的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install openvpn easy-rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我的习惯是把配置文件全都软连接搞出来用vscode看, 接下来就是实现这一步.</p>
<p>把easy-rsa全透出来:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /usr/share/easy-rsa ~/easy-rsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo chmod -R 0777 ~/easy-rsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ubuntu@VM-4-2-ubuntu:~/easy-rsa$ ll</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 28</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">easyrsa -&gt; /usr/share/easy-rsa/easyrsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">vars.example -&gt; /usr/share/easy-rsa/vars.example</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里只有vars和easyrsa需要用到, 别的完全忽略即可.</p>
<p>然后复制一份var, 现在跟着我填表即可, 内容照抄即可:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp ~/easy-rsa/vars.example ~/easy-rsa/vars</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo vim ~/easy-rsa/vars</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_CA_EXPIRE	3650</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_CERT_EXPIRE	1080</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Choices are:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#   cn_only  - use just a CN value</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#   org      - use the &quot;traditional&quot; Country/Province/City/Org/OU/email/CN format</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_DN	&quot;cn_only&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_COUNTRY &quot;CN&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_PROVINCE &quot;Beijing&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_CITY &quot;Shanghai&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_ORG &quot;fuck&quot; # 组织名</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">set_var EASYRSA_REQ_EMAIL &quot;fuck@fuck.com&quot; # 邮箱</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其他配置我也没动,基本上不重要. 接下来按流程敲命令即可,里面会有交互,注意注释详解.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 初始化pki (Public Key Infrastructure，即公钥基础设施，它是一个用于管理和分发加密密钥的系统)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa init-pki </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成ca证书，类似https的s，用于验证服务端身份</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 一直回车，生成ca.crt和ca.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa build-ca nopass </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成dh证书，我不知道用来干嘛的</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> # 一直回车，生成dh.pem</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa gen-dh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成服务端密钥对</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成 pki/issued/vpn-server.crt 和 pki/private/vpn-server.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa build-server-full vpn-server nopass </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成客户端密钥对，每次派发一个新的客户端都需要制造证书，也可以直接复用原来的证书</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成 pki/issued/vpn-client.crt 和 pki/private/vpn-client.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ./easyrsa build-client-full vpn-client nopass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看 pki/issued/ 和 pki/private/ ,会发现多了证书和私钥出来：</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="data:image/png;base64,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" width="321" height="257" class="img_ev3q"></p>
<p>然后该生成的都生成完了基本上，开始openvpn上场：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 生成 OpenVPN 的静态密钥文件 ta.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 不生成也可以用，但是某些GUI会显示”不安全“，为了用户感觉”安全“，咱还是加上。</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">openvpn --genkey --secret pki/ta.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 将所有的配置文件都转移到etc/openvpn目录下面</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/ca.crt /etc/openvpn/server/ca.crt </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/dh.pem /etc/openvpn/server/dh.pem </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/issued/vpn-server.crt /etc/openvpn/server/vpn-server.key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/private/vpn-server.key /etc/openvpn/server/vpn-server.key </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo cp pki/ta.key /etc/openvpn/server/ta.key </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>重中之重，必须要<code>cp</code>而不能软连接！！！</p><p>openvpn不认软连接！你可以mv进去<code>/etc/openvpn</code>原始文件，之后再把它们软连接出来，但不能直接把文件软连接进去。</p><p>一定要确保<code>/etc/openvpn</code>下的文件是原始文件，而不是软连接。</p></div></div>
<p>然后创建一个<code>/etc/openvpn/server/check.sh</code>1`文件，作为用户密码验证的脚本：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">check.sh</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 密码文件 用户名 密码明文</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PASSFILE=&quot;/etc/openvpn/openvpnfile&quot; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 用户登录情况的日志</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">LOG_FILE=&quot;/var/log/openvpn-password.log&quot;  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">TIME_STAMP=`date &quot;+%Y-%m-%d %T&quot;`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if [ ! -r &quot;${PASSFILE}&quot; ]; then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo &quot;${TIME_STAMP}: Could not open password file \&quot;${PASSFILE}\&quot; for reading.&quot; &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">CORRECT_PASSWORD=`awk &#x27;!/^;/&amp;&amp;!/^#/&amp;&amp;$1==&quot;&#x27;${username}&#x27;&quot;{print $2;exit}&#x27;    ${PASSFILE}`</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if [ &quot;${CORRECT_PASSWORD}&quot; = &quot;&quot; ]; then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo &quot;${TIME_STAMP}: User does not exist: username=\&quot;${username}\&quot;,password=\&quot;${password}\&quot;.&quot; &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if [ &quot;${password}&quot; = &quot;${CORRECT_PASSWORD}&quot; ]; then</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    echo &quot;${TIME_STAMP}: Successful authentication: username=\&quot;${username}\&quot;.&quot; &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    exit 0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">echo &quot;${TIME_STAMP}: Incorrect password: username=\&quot;${username}\&quot;, password=\&quot;${password}\&quot;.&quot; &gt;&gt; ${LOG_FILE}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">exit 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>创建<code>/etc/openvpn/openvpnfile</code>文件，里面记录所有用户的密码和用户名，明文存储，示例如下：</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">openvpnfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">jw238 123123</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">jwserver ee##rr$$tt%%</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">jwphone ppp22ppp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-serverconf">2. server.conf<a href="#2-serverconf" class="hash-link" aria-label="2. server.conf的直接链接" title="2. server.conf的直接链接">​</a></h3>
<p>接下来设置服务端配置文件，创建一个配置文件如下，尽量在server文件夹里面创建，后面systemd方便操作。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd /etc/openvpn/server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo nano server.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到 剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个conf很有讲究，内容直接决定配置复杂度和效果，仔细看。由于文件太长，我这里放个连接，保证各位能拿到文件样本即可。</p>
<p>国内点这个
<a href="https://jw238.site/assets/server.conf.sample" target="_blank" rel="noopener noreferrer">server.conf</a></p>
<p>国外点这个
<a href="https://jabberwocky238.github.io/assets/server.conf.sample" target="_blank" rel="noopener noreferrer">server.conf</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-clientconfovpn">3. client.conf(.ovpn)<a href="#3-clientconfovpn" class="hash-link" aria-label="3. client.conf(.ovpn)的直接链接" title="3. client.conf(.ovpn)的直接链接">​</a></h3>
<p>client.conf是linux文件，client.ovpn是windows文件，安卓系统皆可。</p>
<p>为了方便派发，我们把所有东西，证书啊密钥啊什么的，全部放进一个文件。接下来是一个实例，你按照我的要求进行复制即可：</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>点击查看 client.conf/client.ovpn</summary><div><div class="collapsibleContent_i85q">
  <!-- -->
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># client指明这是个客户端文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 验证远程服务器有没有开启tls，如果你没开，就把这个注释掉</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">remote-cert-tls server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 失败无限重连</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">resolv-retry infinite</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># tun模式</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dev tun</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 公网IP, 端口，UDP/TCP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># remote x.x.x.x &lt;port&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">remote 154.20.78.20 9999 # 已脱敏，放心</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">proto udp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 不主动拉取服务端路径，防止全部流量都走VPN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">route-nopull</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 限定10.8.66.0/24的流量经过VPN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">route 10.8.66.0  255.255.255.0 vpn_gateway</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 看好你的加密方法和压缩方法</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cipher AES-256-GCM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">auth SHA1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">;comp-lzo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 使用密码验证</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">auth-user-pass</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 不绑定固定端口，客户端都这样</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">nobind</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 允许循环路由，要不然找不到家</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">allow-recursive-routing</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;ca&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MIIDSzCCAjOgAwIBAgIUcRw0kjFHdfnkTB+HgIMAnkt61S0wDQYJKoZIhvcNAQEL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">一大坨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MDIzMDIzOTQ1WjAWMRQwEgYDVQQDDAtFYXN5LVJTQSBDQTCCASIwDQYJKoZIhvcN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END CERTIFICATE-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/ca&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;key&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCN2YkgCmIZB2Gu</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">一大坨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DyZJHquhNczvbk81E3Gd0tgpevGx3qwQO67VIAG6veRAX4nRgAJMPJ3Sw/Jv8Hhe</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END PRIVATE KEY-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/key&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;cert&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">MIIDoDCCAoigAwIBAgIRAIGOQYVP1w+kSGx66gpyH4owDQYJKoZIhvcNAQELBQAw</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">一大坨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DwAwggEKAoIBAQCN2YkgCmIZB2GuDyZJHquhNczvbk81E3Gd0tgpevGx3qwQO67V</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END CERTIFICATE-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/cert&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">key-direction 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;tls-auth&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 2048 bit OpenVPN static key</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----BEGIN OpenVPN Static key V1-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">b28b01af792acedbd8faaf80ab4716e3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">一小坨</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">f5e36f61f95697b3f800d712996259db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-----END OpenVPN Static key V1-----</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/tls-auth&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-启动">4. 启动<a href="#4-启动" class="hash-link" aria-label="4. 启动的直接链接" title="4. 启动的直接链接">​</a></h3>
<p>直接命令行启动，不建议</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo openvpn --daemon --config server.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo openvpn --config server.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>systemd启动，更好</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start openvpn-server@server</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl status openvpn-server@server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>systemd情况要注意，你的server.conf文件的名字，其实就是@后的名字，换言之，如果你的server.conf叫abcd.conf，那么在systemd启动时，命令行应该如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start openvpn-server@abcd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>linux客户端同理，windows客户端和android客户端直接用GUI更好。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-测试">5. 测试<a href="#5-测试" class="hash-link" aria-label="5. 测试的直接链接" title="5. 测试的直接链接">​</a></h3>
<p>我的妈呀，好费劲啊，好复杂啊，卧槽...而且这玩意很丑你知道吗，你跟clash和v2ray的界面一比，简直丑爆了。但是架不住他设置全面，覆盖面广，重武器有重武器的好。</p>
<p>接下来咱们准备两台设备，一个电脑一个手机，都连到VPN上，电脑打开一个python flask web，手机访问其公网IP和端口。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">10.8.66.1 公网服务器</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10.8.66.2 电脑</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10.8.66.3 手机</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>电脑的flask开在0.0.0.0的5000端口上，手机浏览器访问10.8.66.2:5000应该是可以打开的flask页面的，同理即可穿透其他内网服务，比如其他设备的docker容器，mysql甚至是ssh，mcsmanager就更不在话下了。</p>
<p><em>哪怕MC本身都是可以穿透的</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三wireguard">三，WireGuard<a href="#三wireguard" class="hash-link" aria-label="三，WireGuard的直接链接" title="三，WireGuard的直接链接">​</a></h2>
<p>有没有更方便的方法，直接“开VPN”即访问内网，关VPN即无法访问。于是我找到了<a href="https://www.wireguard.com/" target="_blank" rel="noopener noreferrer">WireGuard</a>。</p>
<p>配置极度简单，但是坏处是没法密码验证，必须每个客户端独立密钥对，管理起来会麻烦，但是GUI好看，官方定制GUI，而且Wireguard速度比OpenVPN快。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-单机配置">1. 单机配置<a href="#1-单机配置" class="hash-link" aria-label="1. 单机配置的直接链接" title="1. 单机配置的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install wireguard</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 构建密钥对，记得管理好，容易乱</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># PUBLIC_KEY和PRIVATE_KEY替换成你喜欢的名字</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wg genkey | tee keys/$PRIVATE_KEY | wg pubkey &gt; keys/$PUBLIC_KEY</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="alt text" src="/assets/images/image-1-a7bc82e606d7bf9e846847dd6681e77e.png" width="322" height="397" class="img_ev3q"></p>
<p>然后创建一个配置文件，内容如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo vim /etc/wireguard/wg0.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">wg0.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = 服务器密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 192.168.238.1/24</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># Wireguard监听端口，默认是51820</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">ListenPort = 51820 </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostUp = iptables -A FORWARD -o wg0 -j ACCEPT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostUp = iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostDown = iptables -D FORWARD -o wg0 -j ACCEPT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostDown = iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 你的DNS服务器，可以自建，不自建的话就注释掉</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">DNS = 192.168.238.1</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = 客户端公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 此  机器内网IP，/32意思是子网掩码是255.255.255.255</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 换言之这玩意只有自己的IP作为子网</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 192.168.238.2/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 握手速度，不是必须的，一般写个30秒上下足够，如果要实时性高可以写更短</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PersistentKeepalive = 25</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>PostUp和PostDown里面的“wg0”是当前文件的名字，你可以随便取，但是要保持一致。</p>
<p>PostUp和PostDown是WireGuard的钩子，用于iptable，kimi一下iptable是什么吧，这是一个很牛的东西。</p>
<p>如果你不想费心思考虑iptable的原理，我可以简单解释这三句话啥意思：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 允许wg0接口的数据包进来，inbound</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PostUp = iptables -A FORWARD -i wg0 -j ACCEPT;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 允许wg0接口的数据包出去，outbound</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PostUp = iptables -A FORWARD -o wg0 -j ACCEPT;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 允许wg0接口的数据包出去，但是要做NAT，转换到eth0（实际网卡）的IP</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PostUp = iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后你的电脑或者手机开一个wireguard，写如下文件：</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">client.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = 客户端密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 192.168.238.2/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># 你的DNS服务器，可以自建，不自建的话就注释掉</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">DNS = 192.168.238.1</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = 服务器公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 192.168.238.0/24</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PersistentKeepalive = 25</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后192.168.238.0/24网段的所有主机你都可以访问了。测试方法同openvpn，开一个flask，手机访问，成功即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-内网设备互联">2. 内网设备互联<a href="#2-内网设备互联" class="hash-link" aria-label="2. 内网设备互联的直接链接" title="2. 内网设备互联的直接链接">​</a></h3>
<p>如果你想要内网机器互联，不需要增加Peer，只需要在每台机器上配置好client.conf。</p>
<p><strong>举例：</strong></p>
<p>设备A公网，设备B内网，设备C内网，B与C互相不通，现在要使用A作为VPN网关，使得B与C互通。</p>
<p>假设A内网IP是10.99.0.1，B是10.99.0.2，C是10.99.0.3。</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">A.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = A密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 10.99.0.1/24</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">ListenPort = 51820 </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostUp = 略</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PostDown = 略</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = B公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 10.99.0.2/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = C公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 10.99.0.3/32</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">B.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = B密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 10.99.0.2/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = A公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 10.99.0.0/24</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">C.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Interface]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PrivateKey = C密钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Address = 10.99.0.3/32</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">[Peer]</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PublicKey = A公钥</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#F8F8F2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">AllowedIPs = 10.99.0.0/24</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此三设备互相可以ping通，使用内网IP即可。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>如果三者其一开启网络服务，记得暴露在0.0.0.0网段或者指定在10.99.0.0/24网段，否则，一般的127.0.0.1，由于你没设置iptable，是访问不到的。</p><p>或者使用nginx进行反向代理，把localhost代理到内网网段，下文有所涉猎。</p></div></div>
<p>A的Peer设置里，10.99.0.0/24的意思是，只有10.99.0.0/24网段的流量会被此VPN接管，其他流量都是直连状态，不会接管。</p>
<p>换言之，如果你写<code>AllowedIPs = 0.0.0.0</code>，那么A就类似 <strong>“梯”</strong> 了。</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>wireguard可以做 <strong>“梯”</strong> ，但是诸多事件告诉我们，应该选择更安全的协议，wireguard并不能很好的隐藏自己，有兴趣可点我个人站，有你想看的。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-web-gui管理器">3. Web GUI管理器<a href="#3-web-gui管理器" class="hash-link" aria-label="3. Web GUI管理器的直接链接" title="3. Web GUI管理器的直接链接">​</a></h3>
<p>wireguard的好处，比OpenVPN好的地方，就是他有一个开源的，非常好的webGUI，弥补了它没密码表不好管理的缺陷，github连接在这，<a href="https://github.com/ngoduykhanh/wireguard-ui" target="_blank" rel="noopener noreferrer">wireguard-ui</a>，占用空间也很小，2核2G的服务器绰绰有余可以跑这个，还能加上nginx，都吃不到20%。</p>
<p>使用方法，官方给出了直接使用版本，我的建议还是用docker，毕竟这玩意，在不久的未来可能需要多开，毕竟需要留一个只有你能打开的面板（防止管理人员不懂技术，搞坏了，你又不好debug）。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>对于已经在宿主机里装好wireguard的同学，恭喜 你，你跟我完全一样，只需要顺着走完此教程即可。</p></div></div>
<p>docker-compose文件sample官方已经给了，我在这里给你一个我的副本，解释一下每个参数的意义，方便你使用。</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>点击查看 docker-compose.yml</summary><div><div class="collapsibleContent_i85q">
  <!-- -->
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token key atrule">wireguard-ui</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> ngoduykhanh/wireguard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">ui</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> wireguard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">ui</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">cap_add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> NET_ADMIN</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)"># required to show active clients. with this set, you don&#x27;t need to expose the ui port (5000) anymore</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">network_mode</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> host</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> BASE_PATH </span><span class="token comment" style="color:rgb(98, 114, 164)"># web GUI基点，默认是&quot;/&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># ！！！绑定GUI监听端口，也就是nginx转发的位置(proxy_pass http://127.0.0.1:23992;)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> BIND_ADDRESS=127.0.0.1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">23992</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SESSION_SECRET </span><span class="token comment" style="color:rgb(98, 114, 164)"># 额外加密</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SESSION_SECRET_FILE </span><span class="token comment" style="color:rgb(98, 114, 164)"># 额外加密</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SESSION_MAX_DURATION=90 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 额外加密</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># ！！！子网范围，仔细看文档，他直接决定此GUI的全局选项，且容器生命周期内不可修改，你可以删容器来重启</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SUBNET_RANGES=ALL</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">192.168.238.0/24;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_USERNAME=admin </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认用户名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PASSWORD=admin </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认用户密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PASSWORD_FILE </span><span class="token comment" style="color:rgb(98, 114, 164)"># 密码很长的话可以放文件里</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PASSWORD_HASH </span><span class="token comment" style="color:rgb(98, 114, 164)"># 没懂</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PASSWORD_HASH_FILE </span><span class="token comment" style="color:rgb(98, 114, 164)"># 没懂</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_ENDPOINT_ADDRESS=xxx.xxx.xxx.xxx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token number">51280</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># wireguard公网IP和端口，内部可调</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_FAVICON_FILE_PATH </span><span class="token comment" style="color:rgb(98, 114, 164)"># 网站图标</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DNS=192.168.238.1 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 自定义DNS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_MTU=1450 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认设置1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_PERSISTENT_KEEPALIVE=15 </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认设置2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_FIREWALL_MARK=51280 </span><span class="token comment" style="color:rgb(98, 114, 164)"># wireguard公网端口，内部可调</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_TABLE=auto</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># ！！！此GUI监管的wg示例，如果你填了wg1，那么那就会对wg1.conf完全控制，包括开启和关闭，甚至文件修改</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_CONFIG_FILE_PATH=/etc/wireguard/wg1.conf</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_LOG_LEVEL=INFO</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WG_CONF_TEMPLATE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> EMAIL_FROM_ADDRESS=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> EMAIL_FROM_NAME=WireGuard UI</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SENDGRID_API_KEY=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SENDGRID_API_KEY_FILE=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># SMTP和TELEGRAM通知，你不设置就不用填，没用。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_HOSTNAME=127.0.0.1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_PORT=25</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_USERNAME=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_PASSWORD=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_PASSWORD_FILE=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_AUTH_TYPE=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_ENCRYPTION=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> SMTP_HELO=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> TELEGRAM_TOKEN=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> TELEGRAM_ALLOW_CONF_REQUEST=false</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> TELEGRAM_FLOOD_WAIT=60</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># 默认配置一大堆，注意POST_UP和POST_DOWN对应的wg1，名字别错了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_SERVER_INTERFACE_ADDRESSES=192.168.238.1/24</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_SERVER_LISTEN_PORT=51280</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_SERVER_POST_UP_SCRIPT=iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">A FORWARD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">i wg1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j ACCEPT; iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">A FORWARD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">o wg1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j ACCEPT; iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">t nat </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">A POSTROUTING </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">o eth0 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j MASQUERADE;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_SERVER_POST_DOWN_SCRIPT=iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">D FORWARD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">i wg1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j ACCEPT; iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">D FORWARD </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">o wg1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j ACCEPT; iptables </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">t nat </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">D POSTROUTING </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">o eth0 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">j MASQUERADE;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DEFAULT_CLIENT_ALLOWED_IPS=192.168.238.0/24</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DEFAULT_CLIENT_EXTRA_ALLOWED_IPS=</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DEFAULT_CLIENT_USE_SERVER_DNS=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_DEFAULT_CLIENT_ENABLE_AFTER_CREATION=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)"># ！！！一定要true，让容器直接控制宿主机wg1启停</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_MANAGE_START=true</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> WGUI_MANAGE_RESTART=true</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">logging</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">driver</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> json</span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain">file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token key atrule">options</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token key atrule">max-size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> 50m</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> ./db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">/app/db</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-</span><span class="token plain"> /etc/wireguard</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain">/etc/wireguard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</div></div></details>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四dnsbind9-named">四，DNS(bind9, named)<a href="#四dnsbind9-named" class="hash-link" aria-label="四，DNS(bind9, named)的直接链接" title="四，DNS(bind9, named)的直接链接">​</a></h2>
<p>DNS服务器，用于解析域名。你连上自定义的VPN之后，内网的兄弟姐妹连你的服务还得手敲IP，多没面子！所以我们来搞一个DNS服务器，给他一个漂亮的域名，看起来就爽多了。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install bind9</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /etc/bind /home/ubuntu/bind</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后你会看到如下场景：</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="/assets/images/image-3-873a43458e0a4f78c580b237250bdc17.png" width="566" height="481" class="img_ev3q"></p>
<p>首先复制一下db.local，然后改一个你喜欢的名字，像我一样，然后改文件。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">db.jw238server</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; BIND data file for jw.boom</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$TTL    86400</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; 这里写基础域名，据我所知你可以写的很骚，我这里非常保守，你可以写好长一串</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@   IN  SOA jw.boom. root.jw.boom. (</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                              1         ; Serial</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         604800         ; Refresh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                          86400         ; Retry</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        2419200         ; Expire</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                         604800 )       ; Negative Cache TTL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; 默认nameserver，必写，我这里写的是station</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; 你可以直接解析到IP，或者像我一样隔一层</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@           IN      NS      station </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; A是解析到IPV4地址，AAAA是解析到IPV6地址</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">station     IN      A       192.168.238.1 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; CNAME是别名</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">dns         IN      CNAME   station</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mcs         IN      CNAME   station</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mcworld     IN      A       192.168.238.2</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mc          IN      CNAME   mcworld</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">gigachad    IN      A       192.168.238.5</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">; 下面两句必写，否则会报错</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@	        IN	    A     	127.0.0.1 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">@	        IN	    AAAA	  ::1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后找到<code>named.conf.local</code>，加一行这个。</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">named.conf.local</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// 定义域名的核心在这里</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">zone &quot;jw.boom&quot; {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	type master;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	file &quot;/etc/bind/db.jw238server&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后找到<code>named.conf.options</code>，改写转发规则。</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">named.conf.options</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">options {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	directory &quot;/var/cache/bind&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // 不forward，因为你都解析不出来，那肯定就不是自定义的域名了 </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	// forwarders { 8.8.8.8; };</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	dnssec-validation no; // 关了不报错</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	listen-on port 53 { </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		192.168.238.1; // 本机内网IP，也是你的DNS服务器</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	};</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  listen-on-v6 { any; }; // 解析IPV6</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	recursion yes; // 循环查询dns</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	allow-query { any; }; </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后记得重启named(bind9)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl restart named</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果你的服务暴露在内网段，你已经可以通过域名+端口直接访问了，但是如果你想去掉恶心的端口，或者转发127.0.0.1的服务，就需要nginx。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="五nginx">五，Nginx<a href="#五nginx" class="hash-link" aria-label="五，Nginx的直接链接" title="五，Nginx的直接链接">​</a></h2>
<p>咋装咋开：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo apt install nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /etc/nginx /home/ubuntu/nginx</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /var/www/html /home/ubuntu/nginx/html</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo ln -s /var/log/nginx /home/ubuntu/nginx/log</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl start nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>分conf文件我就不教了，可以搜nginx教学，这里只教快速映射端口和域名。</p>
<p>找到nginx的http块。</p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockTitle_Ktv7">nginx.conf</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    # ...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    map $http_host $backend_port {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        mcsmanager.jw.boom 23333;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        mc.jw.boom 25565;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        gigachad.jw.boom 6666;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    server {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        listen 80;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        location / {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            proxy_pass http://127.0.0.1:$backend_port;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>map格式，左边域名，右边端口，域名支持正则匹配。</p>
<p>下面server块，我还不知道怎么魔改，建议照抄。</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>这个server块和map块必须直接放在http块下，不能放入单独的conf文件引入，因为map块有作用域。</p></div></div>
<p>记得重启：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 重启之间测试一下配置文件</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo nginx -t</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 如果报错了，看看配置哪不对</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># 重启</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">sudo systemctl reload nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>至此，你在VPN服务器直接开一个mcsmanager，你的小伙伴应该可以通过mcsmanager.jw.boom来访问控制面板了。</p>
<p>然后同一个VPN下的同学可以直接通过内网IP加端口号访问对方的世界 。</p>
<p>例如公网机器A(192.169.0.1)，同学B(192.169.0.2)，同学C(192.169.0.3)，其中B开了一个世界，局域网端口为48888，那么C可以通过192.168.0.2:48888连入世界。</p>
<p>或者如果你做了DNS，把192.169.0.2解析到了gigachad.jw.boom，那么C同学就可以通过gigachad.jw.boom:48888连入世界。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>如果B访问C的mcsmanager控制面板，需要在A里面做DNS解析，在C里面做nginx代理。</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="changelog">CHANGELOG<a href="#changelog" class="hash-link" aria-label="CHANGELOG的直接链接" title="CHANGELOG的直接链接">​</a></h2>
<blockquote>
<p>created at: 2024-10-27T18:00<br>
modified at: 2024-11-01T23:09</p>
<ul>
<li>补齐了dns和nginx部分</li>
<li>加入了wireguard web GUI</li>
</ul>
<p>modified at: 2024-11-02T12:03</p>
<ul>
<li>加上了导读</li>
<li>制作知乎版单文件，github仓库可见</li>
</ul>
<p>modified at: 2024-11-04T02:03</p>
<ul>
<li>codeblock 美化</li>
</ul>
<p>modified at: 2024-11-04T17:12</p>
<ul>
<li>details-summary 美化大块代码</li>
</ul>
</blockquote></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a title="Blogs Written In Chinese" class="tag_zVej tagRegular_sFm0" href="/blog/tags/zh">zh</a></li><li class="tag_QGVx"><a title="All technical blogs" class="tag_zVej tagRegular_sFm0" href="/blog/tags/tech">tech</a></li><li class="tag_QGVx"><a title="Very good blogs, worth reading again and again" class="tag_zVej tagRegular_sFm0" href="/blog/tags/golden">golden</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>jabberwocky238</b> <!-- -->于 <b><time datetime="2024-11-04T02:40:00.000Z" itemprop="dateModified">2024年11月4日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2024/11/01/trojan-gfw"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">trojan使用记录</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2024/10/07/Recursive-and-Loop-rust"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">rust中变换递归为循环的必要性</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一前情提要" class="table-of-contents__link toc-highlight">一，前情提要</a></li><li><a href="#二openvpn" class="table-of-contents__link toc-highlight">二，OpenVPN</a><ul><li><a href="#1-init" class="table-of-contents__link toc-highlight">1. init</a></li><li><a href="#2-serverconf" class="table-of-contents__link toc-highlight">2. server.conf</a></li><li><a href="#3-clientconfovpn" class="table-of-contents__link toc-highlight">3. client.conf(.ovpn)</a></li><li><a href="#4-启动" class="table-of-contents__link toc-highlight">4. 启动</a></li><li><a href="#5-测试" class="table-of-contents__link toc-highlight">5. 测试</a></li></ul></li><li><a href="#三wireguard" class="table-of-contents__link toc-highlight">三，WireGuard</a><ul><li><a href="#1-单机配置" class="table-of-contents__link toc-highlight">1. 单机配置</a></li><li><a href="#2-内网设备互联" class="table-of-contents__link toc-highlight">2. 内网设备互联</a></li><li><a href="#3-web-gui管理器" class="table-of-contents__link toc-highlight">3. Web GUI管理器</a></li></ul></li><li><a href="#四dnsbind9-named" class="table-of-contents__link toc-highlight">四，DNS(bind9, named)</a></li><li><a href="#五nginx" class="table-of-contents__link toc-highlight">五，Nginx</a></li><li><a href="#changelog" class="table-of-contents__link toc-highlight">CHANGELOG</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 JW238, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>